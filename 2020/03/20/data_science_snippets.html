
<h1 id="pandas-cheat-sheet-for-data-science">Pandas cheat sheet for data science</h1>

<ul>
  <li><a href="#pandas-cheat-sheet-for-data-science">Pandas cheat sheet for data science</a></li>
  <li><a href="#statistics">Statistics</a>
    <ul>
      <li><a href="#multi-variate-analysis">Multi-variate analysis</a></li>
      <li><a href="#feature-understanding">Feature understanding</a></li>
    </ul>
  </li>
  <li><a href="#preliminaries">Preliminaries</a></li>
  <li><a href="#import">Import</a></li>
  <li><a href="#input-output">Input Output</a>
    <ul>
      <li><a href="#input">Input</a>
        <ul>
          <li><a href="#reading-files">Reading files</a></li>
        </ul>
      </li>
      <li><a href="#output">Output</a></li>
    </ul>
  </li>
  <li><a href="#exploration">Exploration</a></li>
  <li><a href="#selecting">Selecting</a>
    <ul>
      <li><a href="#summary">Summary</a></li>
      <li><a href="#whole-dataframe">Whole DataFrame</a></li>
      <li><a href="#columns">Columns</a></li>
      <li><a href="#rows">Rows</a></li>
      <li><a href="#cells">Cells</a></li>
    </ul>
  </li>
  <li><a href="#data-wrangling">Data wrangling</a>
    <ul>
      <li><a href="#merge-join">Merge Join</a></li>
      <li><a href="#groupby">GroupBy</a></li>
      <li><a href="#dates">Dates</a></li>
      <li><a href="#missing-data">Missing data</a></li>
      <li><a href="#categorical-data">Categorical Data</a></li>
      <li><a href="#manipulations">Manipulations</a>
        <ul>
          <li><a href="#method-chaining">Method chaining</a></li>
          <li><a href="#binning">Binning</a></li>
        </ul>
      </li>
      <li><a href="#fast-append-to-dataframe">fast append to dataframe</a></li>
    </ul>
  </li>
  <li><a href="#performance">Performance</a>
    <ul>
      <li><a href="#reshaping-dataframe">Reshaping dataframe</a></li>
      <li><a href="#concat-vs-append">Concat vs. append</a></li>
      <li><a href="#dataframe--iterate-rows">Dataframe: iterate rows</a>
        <ul>
          <li><a href="#useful-links">Useful links</a></li>
        </ul>
      </li>
      <li><a href="#parallel-data-structures">Parallel data structures</a></li>
    </ul>
  </li>
  <li><a href="#jupyter-notebooks">Jupyter notebooks</a>
    <ul>
      <li><a href="#notebooks-in-production">Notebooks in production</a>
        <ul>
          <li><a href="#workflow">workflow</a></li>
          <li><a href="#directory-structure">Directory structure</a></li>
          <li><a href="#further-link">Further link</a></li>
          <li><a href="#jupyter-notebook-template">jupyter notebook template</a>
            <ul>
              <li><a href="#header-section">header section</a></li>
            </ul>
          </li>
          <li><a href="#orchestration">Orchestration</a></li>
          <li><a href="#code-snippets">code snippets</a></li>
        </ul>
      </li>
      <li><a href="#timing-and-profiling">Timing and Profiling</a>
        <ul>
          <li><a href="#testing">Testing</a></li>
          <li><a href="#qgrid">Qgrid</a></li>
          <li><a href="#debugging-conda">Debugging conda</a></li>
          <li><a href="#running-jupyter">Running Jupyter</a></li>
          <li><a href="#installing-kernels">installing kernels</a></li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<p><small><i><a href="http://ecotrust-canada.github.io/markdown-toc/">Table of contents generated with markdown-toc</a></i></small></p>

<h1 id="statistics">Statistics</h1>

<h2 id="multi-variate-analysis">Multi-variate analysis</h2>
<p><strong>Understand the problem</strong>.</p>
<ul>
  <li>
    <p>Normal distribution
```python
    #histogram
    sns.distplot(df_train[‘SalePrice’]);</p>
  </li>
  <li>Skewness/Kurtosis?
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="c1">#skewness and kurtosis
</span>  <span class="k">print</span><span class="p">(</span><span class="s">"Skewness: </span><span class="si">%</span><span class="s">f"</span> <span class="o">%</span> <span class="n">df_train</span><span class="p">[</span><span class="s">'SalePrice'</span><span class="p">]</span><span class="o">.</span><span class="n">skew</span><span class="p">())</span>
  <span class="k">print</span><span class="p">(</span><span class="s">"Kurtosis: </span><span class="si">%</span><span class="s">f"</span> <span class="o">%</span> 	<span class="n">df_train</span><span class="p">[</span><span class="s">'SalePrice'</span><span class="p">]</span><span class="o">.</span><span class="n">kurt</span><span class="p">())</span><span class="sb">``</span><span class="err">`</span>
</code></pre></div>    </div>
  </li>
  <li>Show peakedness</li>
</ul>

<p><strong>Univariable study</strong></p>

<p>Relationship with numerical variables</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#scatter plot grlivarea/saleprice
</span><span class="n">var</span> <span class="o">=</span> <span class="s">'GrLivArea'</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df_train</span><span class="p">[</span><span class="s">'SalePrice'</span><span class="p">],</span> <span class="n">df_train</span><span class="p">[</span><span class="n">var</span><span class="p">]],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">data</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">var</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s">'SalePrice'</span><span class="p">,</span> <span class="n">ylim</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">800000</span><span class="p">));</span>
</code></pre></div></div>
<p>Relationship with categorical features</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#box plot overallqual/saleprice
</span><span class="n">var</span> <span class="o">=</span> <span class="s">'OverallQual'</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df_train</span><span class="p">[</span><span class="s">'SalePrice'</span><span class="p">],</span> <span class="n">df_train</span><span class="p">[</span><span class="n">var</span><span class="p">]],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">f</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">var</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s">"SalePrice"</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="n">ymin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ymax</span><span class="o">=</span><span class="mi">800000</span><span class="p">);</span>
</code></pre></div></div>

<ol>
  <li><strong>Multivariate study</strong>. We’ll try to understand how the dependent variable and independent variables relate.</li>
</ol>

<p>Correlation matrix (heatmap style)</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#correlation matrix
</span><span class="n">corrmat</span> <span class="o">=</span> <span class="n">df_train</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span>
<span class="n">f</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">9</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">corrmat</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mf">.8</span><span class="p">,</span> <span class="n">square</span><span class="o">=</span><span class="bp">True</span><span class="p">);</span>
<span class="c1"># and zoomed corr matrix
</span>
<span class="n">k</span> <span class="o">=</span> <span class="mi">10</span> <span class="c1">#number of variables for heatmap
</span><span class="n">cols</span> <span class="o">=</span> <span class="n">corrmat</span><span class="o">.</span><span class="n">nlargest</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="s">'SalePrice'</span><span class="p">)[</span><span class="s">'SalePrice'</span><span class="p">]</span><span class="o">.</span><span class="n">index</span>
<span class="n">cm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">corrcoef</span><span class="p">(</span><span class="n">df_train</span><span class="p">[</span><span class="n">cols</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="nb">set</span><span class="p">(</span><span class="n">font_scale</span><span class="o">=</span><span class="mf">1.25</span><span class="p">)</span>
<span class="n">hm</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">cm</span><span class="p">,</span> <span class="n">cbar</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">annot</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">square</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s">'.2f'</span><span class="p">,</span> <span class="n">annot_kws</span><span class="o">=</span><span class="p">{</span><span class="s">'size'</span><span class="p">:</span> <span class="mi">10</span><span class="p">},</span> <span class="n">yticklabels</span><span class="o">=</span><span class="n">cols</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">xticklabels</span><span class="o">=</span><span class="n">cols</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="https://csiu.github.io/blog//img/figure/2017-03-19/heatmap.png =255x" alt="Pairplor" /></p>

<p>Scatter plots between target and correlated variables</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#scatterplot
</span><span class="n">sns</span><span class="o">.</span><span class="nb">set</span><span class="p">()</span>
<span class="n">cols</span> <span class="o">=</span> <span class="p">[</span><span class="s">'SalePrice'</span><span class="p">,</span> <span class="s">'OverallQual'</span><span class="p">,</span> <span class="s">'GrLivArea'</span><span class="p">,</span> <span class="s">'GarageCars'</span><span class="p">,</span> <span class="s">'TotalBsmtSF'</span><span class="p">,</span> <span class="s">'FullBath'</span><span class="p">,</span> <span class="s">'YearBuilt'</span><span class="p">]</span>
<span class="n">sns</span><span class="o">.</span><span class="n">pairplot</span><span class="p">(</span><span class="n">df_train</span><span class="p">[</span><span class="n">cols</span><span class="p">],</span> <span class="n">size</span> <span class="o">=</span> <span class="mf">2.5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">();</span>
</code></pre></div></div>
<p><img src="https://seaborn.pydata.org/_images/seaborn-pairplot-1.png =255x" alt="Pairplor" />
<strong>Basic cleaning</strong>. We’ll clean the dataset and handle the missing data, outliers and categorical variables.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#missing data
</span><span class="n">total</span> <span class="o">=</span> <span class="n">df_train</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="nb">sum</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="n">percent</span> <span class="o">=</span> <span class="p">(</span><span class="n">df_train</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="nb">sum</span><span class="p">()</span><span class="o">/</span><span class="n">df_train</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">count</span><span class="p">())</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="n">missing_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">total</span><span class="p">,</span> <span class="n">percent</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="p">[</span><span class="s">'Total'</span><span class="p">,</span> <span class="s">'Percent'</span><span class="p">])</span>
<span class="n">missing_data</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
</code></pre></div></div>

<p><strong>Test assumptions</strong>. We’ll check if our data meets the assumptions required by most multivariate techniques.</p>

<h2 id="feature-understanding">Feature understanding</h2>

<ul>
  <li>
    <p>Are the features continuous, discrete or none of the above?</p>
  </li>
  <li>
    <p>What is the distribution of this feature?</p>
  </li>
  <li>Does the distribution largely depend on what subset of examples is being considered?
    <ul>
      <li>Time-based segmentation?</li>
      <li>Type-based segmentation?</li>
    </ul>
  </li>
  <li>Does this feature contain holes (missing values)?
    <ul>
      <li>Are those holes possible to be filled, or would they stay forever?</li>
      <li>If it possible to eliminate them in the future data?</li>
    </ul>
  </li>
  <li>Are there duplicate and/or intersecting examples?
    <ul>
      <li>Answering this question right is extremely important, since duplicate or connected data points might significantly affect the results of model validation if not properly excluded.</li>
    </ul>
  </li>
  <li>Where do the features come from?
    <ul>
      <li>Should we come up with the new features that prove to be useful, how hard would it be to incorporate those features in the final design?</li>
    </ul>
  </li>
  <li>Is the data real-time?
    <ul>
      <li>Are the requests real-time?</li>
    </ul>
  </li>
  <li>If yes, well-engineered simple features would likely rock.
    <ul>
      <li>If no, we likely are in the business of advanced models and algorithms.</li>
    </ul>
  </li>
  <li>
    <p>Are there features that can be used as the “truth”?
Plots</p>

    <ol>
      <li>Supervised vs. unsupervised learning</li>
      <li>classification vs. regression</li>
      <li>Prediction vs. Inference
    9.  Baseline Modeling
    10.  Secondary Modeling
    11.  Communicating Results
    12.  Conclusion
    13.  Resources</li>
    </ol>
  </li>
</ul>

<h1 id="preliminaries">Preliminaries</h1>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># import libraries (standard)
</span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="n">pd</span>
<span class="kn">from</span> <span class="nn">pandas</span> <span class="kn">import</span> <span class="n">DataFrame</span><span class="p">,</span> <span class="n">Series</span>
</code></pre></div></div>

<h1 id="import">Import</h1>
<p><a href="https://chrisyeh96.github.io/2017/08/08/definitive-guide-python-imports.html">https://chrisyeh96.github.io/2017/08/08/definitive-guide-python-imports.html</a></p>

<h1 id="input-output">Input Output</h1>
<h2 id="input">Input</h2>
<p>Empty DataFrame (<a href="#top">top</a>)</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># dataframe empty
</span><span class="n">df</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">()</span>
</code></pre></div></div>
<p>CSV (<a href="#top">top</a>)</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># pandas read csv
</span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">'file.csv'</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">'file.csv'</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">quotechar</span><span class="o">=</span><span class="s">'"'</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">':'</span><span class="p">,</span> <span class="n">na_values</span> <span class="o">=</span> <span class="p">[</span><span class="s">'na'</span><span class="p">,</span> <span class="s">'-'</span><span class="p">,</span> <span class="s">'.'</span><span class="p">,</span> <span class="s">''</span><span class="p">])</span>
<span class="c1"># specifying "." and "NA" as missing values in the Last Name column and "." as missing values in Pre-Test Score column
</span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">'../data/example.csv'</span><span class="p">,</span> <span class="n">na_values</span><span class="o">=</span><span class="p">{</span><span class="s">'Last Name'</span><span class="p">:</span> <span class="p">[</span><span class="s">'.'</span><span class="p">,</span> <span class="s">'NA'</span><span class="p">],</span> <span class="s">'Pre-Test Score'</span><span class="p">:</span> <span class="p">[</span><span class="s">'.'</span><span class="p">]})</span> 
<span class="c1"># skipping the top 3 rows
</span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">'../data/example.csv'</span><span class="p">,</span> <span class="n">na_values</span><span class="o">=</span><span class="n">sentinels</span><span class="p">,</span> <span class="n">skiprows</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="c1"># interpreting "," in strings around numbers as thousands separators
</span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">'../data/example.csv'</span><span class="p">,</span> <span class="n">thousands</span><span class="o">=</span><span class="s">','</span><span class="p">)</span> 

<span class="c1"># `encoding='latin1'`, `encoding='iso-8859-1'` or `encoding='cp1252'`
</span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">'example.csv'</span><span class="p">,</span><span class="n">encoding</span><span class="o">=</span><span class="s">'latin1'</span><span class="p">)</span>
</code></pre></div></div>

<p>CSV (Inline) (<a href="#top">top</a>)</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># pandas read string
</span><span class="kn">from</span> <span class="nn">io</span> <span class="kn">import</span> <span class="n">StringIO</span>
<span class="n">data</span> <span class="o">=</span> <span class="s">""", Animal, Cuteness, Desirable
row-1, dog, 8.7, True
row-2, cat, 9.5, True
row-3, bat, 2.6, False"""</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">StringIO</span><span class="p">(</span><span class="n">data</span><span class="p">),</span>
	<span class="n">header</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
	<span class="n">skipinitialspace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</code></pre></div></div>

<p>JSON (<a href="#top">top</a>)</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># pandas read json
</span><span class="kn">import</span> <span class="nn">json</span>
<span class="n">json_data</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">'data-text.json'</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">json_data</span><span class="p">)</span>
<span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
    <span class="k">print</span> <span class="n">item</span>
</code></pre></div></div>

<p>XML (<a href="#top">top</a>)</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># pandas read xml
</span><span class="kn">from</span> <span class="nn">xml.etree</span> <span class="kn">import</span> <span class="n">ElementTree</span> <span class="k">as</span> <span class="n">ET</span>
<span class="n">tree</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="s">'../../data/chp3/data-text.xml'</span><span class="p">)</span>
<span class="n">root</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">getroot</span><span class="p">()</span>
<span class="k">print</span> <span class="n">root</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">'Data'</span><span class="p">)</span>
<span class="n">all_data</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">observation</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
    <span class="n">record</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">observation</span><span class="p">:</span>
        <span class="n">lookup_key</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">keys</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">lookup_key</span> <span class="o">==</span> <span class="s">'Numeric'</span><span class="p">:</span>
            <span class="n">rec_key</span> <span class="o">=</span> <span class="s">'NUMERIC'</span>
            <span class="n">rec_value</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s">'Numeric'</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">rec_key</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="n">lookup_key</span><span class="p">]</span>
            <span class="n">rec_value</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s">'Code'</span><span class="p">]</span>
        <span class="n">record</span><span class="p">[</span><span class="n">rec_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">rec_value</span>
    <span class="n">all_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">record</span><span class="p">)</span>
<span class="k">print</span> <span class="n">all_data</span>
</code></pre></div></div>

<p>Excel (<a href="#top">top</a>)</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># pandas read excel
</span>
<span class="c1"># Each Excel sheet in a Python dictionary
</span><span class="n">workbook</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">ExcelFile</span><span class="p">(</span><span class="s">'file.xlsx'</span><span class="p">)</span>
<span class="n">d</span> <span class="o">=</span> <span class="p">{}</span> <span class="c1"># start with an empty dictionary
</span><span class="k">for</span> <span class="n">sheet_name</span> <span class="ow">in</span> <span class="n">workbook</span><span class="o">.</span><span class="n">sheet_names</span><span class="p">:</span>
	<span class="n">df</span> <span class="o">=</span> <span class="n">workbook</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">sheet_name</span><span class="p">)</span>
	<span class="n">d</span><span class="p">[</span><span class="n">sheet_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span>
</code></pre></div></div>
<p>MySQL (<a href="#top">top</a>)</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># pandas read sql
</span><span class="kn">import</span> <span class="nn">pymysql</span>
<span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">create_engine</span>
<span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s">'mysql+pymysql://'</span>
<span class="o">+</span><span class="s">'USER:PASSWORD@HOST/DATABASE'</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_table</span><span class="p">(</span><span class="s">'table'</span><span class="p">,</span> <span class="n">engine</span><span class="p">)</span>
</code></pre></div></div>

<p>Combine DataFrame (<a href="#top">top</a>)</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># pandas concat dataframes
</span>
<span class="c1"># Example 1 ...
</span><span class="n">s1</span> <span class="o">=</span> <span class="n">Series</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">))</span>
<span class="n">s2</span> <span class="o">=</span> <span class="n">s1</span> <span class="o">*</span> <span class="n">s1</span>
<span class="n">s2</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">s2</span><span class="o">.</span><span class="n">index</span> <span class="o">+</span> <span class="mi">2</span><span class="c1"># misalign indexes
</span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="c1"># Example 2 ...
</span><span class="n">s3</span> <span class="o">=</span> <span class="n">Series</span><span class="p">({</span><span class="s">'Tom'</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="s">'Dick'</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span> <span class="s">'Har'</span><span class="p">:</span><span class="mi">9</span><span class="p">})</span>
<span class="n">s4</span> <span class="o">=</span> <span class="n">Series</span><span class="p">({</span><span class="s">'Tom'</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="s">'Dick'</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="s">'Mar'</span><span class="p">:</span><span class="mi">5</span><span class="p">})</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">({</span><span class="s">'A'</span><span class="p">:</span><span class="n">s3</span><span class="p">,</span> <span class="s">'B'</span><span class="p">:</span><span class="n">s4</span> <span class="p">},</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div></div>

<p>From Dictionary (<a href="#top">top</a>) 
default — assume data is in columns</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># pandas read dictionary 
</span><span class="n">df</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">({</span>
	<span class="s">'col0'</span> <span class="p">:</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">],</span>
	<span class="s">'col1'</span> <span class="p">:</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">400</span><span class="p">]</span>
<span class="p">})</span>
</code></pre></div></div>
<p>use helper method for data in rows</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># pandas read dictionary
</span><span class="n">df</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">({</span> <span class="c1"># data by row
# rows as python dictionaries
</span>	<span class="s">'row0'</span> <span class="p">:</span> <span class="p">{</span><span class="s">'col0'</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="s">'col1'</span><span class="p">:</span><span class="s">'A'</span><span class="p">},</span>
	<span class="s">'row1'</span> <span class="p">:</span> <span class="p">{</span><span class="s">'col0'</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="s">'col1'</span><span class="p">:</span><span class="s">'B'</span><span class="p">}</span>
	<span class="p">},</span> <span class="n">orient</span><span class="o">=</span><span class="s">'index'</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">({</span> <span class="c1"># data by row
# rows as python lists
</span>	<span class="s">'row0'</span> <span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="o">+</span><span class="mf">1j</span><span class="p">,</span> <span class="s">'A'</span><span class="p">],</span>
	<span class="s">'row1'</span> <span class="p">:</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="o">+</span><span class="mf">2j</span><span class="p">,</span> <span class="s">'B'</span><span class="p">]</span>
	<span class="p">},</span> <span class="n">orient</span><span class="o">=</span><span class="s">'index'</span><span class="p">)</span>
</code></pre></div></div>

<p>from iterations of lists</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># pandas read lists
</span><span class="n">aa</span> <span class="o">=</span> <span class="p">[</span><span class="s">'aa1'</span><span class="p">,</span> <span class="s">'aa2'</span><span class="p">,</span> <span class="s">'aa3'</span><span class="p">,</span> <span class="s">'aa4'</span><span class="p">,</span> <span class="s">'aa5'</span><span class="p">]</span>
<span class="n">bb</span> <span class="o">=</span> <span class="p">[</span><span class="s">'bb1'</span><span class="p">,</span> <span class="s">'bb2'</span><span class="p">,</span> <span class="s">'bb3'</span><span class="p">,</span> <span class="s">'bb4'</span><span class="p">,</span> <span class="s">'bb5'</span><span class="p">]</span>
<span class="n">cc</span> <span class="o">=</span> <span class="p">[</span><span class="s">'cc1'</span><span class="p">,</span> <span class="s">'cc2'</span><span class="p">,</span> <span class="s">'cc3'</span><span class="p">,</span> <span class="s">'cc4'</span><span class="p">,</span> <span class="s">'cc5'</span><span class="p">]</span>
<span class="n">lists</span> <span class="o">=</span> <span class="p">[</span><span class="n">aa</span><span class="p">,</span> <span class="n">bb</span><span class="p">,</span> <span class="n">cc</span><span class="p">]</span>

<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="o">*</span><span class="n">lists</span><span class="p">)),</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s">'aa'</span><span class="p">,</span> <span class="s">'bb'</span><span class="p">,</span> <span class="s">'cc'</span><span class="p">])</span>
</code></pre></div></div>
<p>source: <a href="https://stackoverflow.com/questions/45672342/create-a-dataframe-of-permutations-in-pandas-from-list">https://stackoverflow.com/questions/45672342/create-a-dataframe-of-permutations-in-pandas-from-list</a></p>

<p>Examples (<a href="#top">top</a>) 
— simple - default integer indexes</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># pandas read random
</span><span class="n">df</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
</code></pre></div></div>
<p>— with a time-stamp row index:</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># pandas read random timestamp
</span><span class="n">df</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">500</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">df</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s">'1/1/2005'</span><span class="p">,</span>
<span class="n">periods</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">),</span> <span class="n">freq</span><span class="o">=</span><span class="s">'M'</span><span class="p">)</span>
</code></pre></div></div>
<p>— with alphabetic row and col indexes and a “groupable” variable</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">string</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="n">r</span> <span class="o">=</span> <span class="mi">52</span> <span class="c1"># note: min r is 1; max r is 52
</span><span class="n">c</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">c</span><span class="p">),</span>
	<span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s">'col'</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">c</span><span class="p">)],</span>
	<span class="n">index</span> <span class="o">=</span> <span class="nb">list</span><span class="p">((</span><span class="n">string</span><span class="o">.</span> <span class="n">ascii_uppercase</span><span class="o">+</span> <span class="n">string</span><span class="o">.</span><span class="n">ascii_lowercase</span><span class="p">)[</span><span class="mi">0</span><span class="p">:</span><span class="n">r</span><span class="p">]))</span>
	<span class="n">df</span><span class="p">[</span><span class="s">'group'</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="s">''</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="s">'abcde'</span><span class="p">)</span>
	<span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">r</span><span class="p">))</span> <span class="p">)</span>
</code></pre></div></div>

<p>Generate dataframe with 1 variable column</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># pandas dataframe create
</span><span class="n">final_biom_df</span> <span class="o">=</span> <span class="n">final_biom_df</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s">'trial'</span> <span class="p">:</span> <span class="n">curr_trial</span><span class="p">,</span>
                   <span class="s">'biomarker_name'</span> <span class="p">:</span> <span class="n">curr_biomarker</span><span class="p">,</span>
                   <span class="s">'observation_id'</span> <span class="p">:</span> <span class="n">curr_observation</span><span class="p">,</span>
                   <span class="s">'visit'</span> <span class="p">:</span> <span class="n">curr_timepoint</span><span class="p">,</span>
                   <span class="s">'value'</span> <span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">low</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">30</span><span class="p">),</span>
                   <span class="s">'unit'</span> <span class="p">:</span> <span class="n">curr_unit</span><span class="p">,</span>
                   <span class="s">'base'</span> <span class="p">:</span> <span class="n">is_base</span><span class="p">,</span>
              
             <span class="p">})])</span>
</code></pre></div></div>

<h3 id="reading-files">Reading files</h3>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># pandas read multiple files
</span><span class="n">files</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s">'weather/*.csv'</span><span class="p">)</span>
<span class="n">weather_dfs</span> <span class="o">=</span> <span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="n">columns</span><span class="p">)</span> <span class="k">for</span> <span class="n">fp</span> <span class="ow">in</span> <span class="n">files</span><span class="p">]</span>
<span class="n">weather</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">weather_dfs</span><span class="p">)</span>
</code></pre></div></div>

<h2 id="output">Output</h2>
<p>CSV (<a href="#top">top</a>)</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s">'name.csv'</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s">'utf-8'</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s">'filename.csv'</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</code></pre></div></div>
<p>Excel</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">pandas</span> <span class="kn">import</span> <span class="n">ExcelWriter</span>
<span class="n">writer</span> <span class="o">=</span> <span class="n">ExcelWriter</span><span class="p">(</span><span class="s">'filename.xlsx'</span><span class="p">)</span>
<span class="n">df1</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="n">writer</span><span class="p">,</span><span class="s">'Sheet1'</span><span class="p">)</span>
<span class="n">df2</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="n">writer</span><span class="p">,</span><span class="s">'Sheet2'</span><span class="p">)</span>
<span class="n">writer</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</code></pre></div></div>
<p>MySQL (<a href="#top">top</a>)</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">pymysql</span>
<span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">create_engine</span>
<span class="n">e</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s">'mysql+pymysql://'</span> <span class="o">+</span>
	<span class="s">'USER:PASSWORD@HOST/DATABASE'</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">to_sql</span><span class="p">(</span><span class="s">'TABLE'</span><span class="p">,</span><span class="n">e</span><span class="p">,</span> <span class="n">if_exists</span><span class="o">=</span><span class="s">'replace'</span><span class="p">)</span>
</code></pre></div></div>
<p>Python object (<a href="#top">top</a>)</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">d</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span> <span class="c1"># to dictionary
</span><span class="nb">str</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">to_string</span><span class="p">()</span> <span class="c1"># to string
</span><span class="n">m</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">as_matrix</span><span class="p">()</span> <span class="c1"># to numpy matrix
</span></code></pre></div></div>

<p>JSON</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">### orient=’records’
</span>
<span class="n">df</span><span class="o">.</span><span class="n">to_json</span><span class="p">(</span><span class="s">r'Path to store the JSON file\File Name.json'</span><span class="p">,</span><span class="n">orient</span><span class="o">=</span><span class="s">'records'</span><span class="p">)</span>

<span class="p">[{</span><span class="s">"Product"</span><span class="p">:</span><span class="s">"Desktop Computer"</span><span class="p">,</span><span class="s">"Price"</span><span class="p">:</span><span class="mi">700</span><span class="p">},{</span><span class="s">"Product"</span><span class="p">:</span><span class="s">"Tablet"</span><span class="p">,</span><span class="s">"Price"</span><span class="p">:</span><span class="mi">250</span><span class="p">},{</span><span class="s">"Produc</span><span class="err">
</span></code></pre></div></div>
<p>source: <a href="https://datatofish.com/export-pandas-dataframe-json/">https://datatofish.com/export-pandas-dataframe-json/</a></p>

<h1 id="exploration">Exploration</h1>
<p>pandas profiling</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">conda</span> <span class="n">install</span> <span class="o">-</span><span class="n">c</span> <span class="n">anaconda</span> <span class="n">pandas</span><span class="o">-</span><span class="n">profiling</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="n">pd</span>  
<span class="kn">import</span> <span class="nn">pandas_profiling</span>
<span class="c1"># Depreciated: pre 2.0.0 version  
</span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">'titanic/train.csv'</span><span class="p">)</span>  
<span class="c1">#Pandas-Profiling 2.0.0  
</span><span class="n">df</span><span class="o">.</span><span class="n">profile_report</span><span class="p">()</span>
<span class="c1"># save as html
</span><span class="n">profile</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">profile_report</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">'Pandas Profiling Report'</span><span class="p">)</span>
<span class="n">profile</span><span class="o">.</span><span class="n">to_file</span><span class="p">(</span><span class="n">output_file</span><span class="o">=</span><span class="s">"output.html"</span><span class="p">)</span>
</code></pre></div></div>
<p>example report: <a href="https://nbviewer.jupyter.org/github/pandas-profiling/pandas-profiling/blob/master/examples/titanic/titanic_report.html">link</a></p>

<p>source: <a href="https://towardsdatascience.com/10-simple-hacks-to-speed-up-your-data-analysis-in-python-ec18c6396e6b">link</a></p>

<p>overview missing data:</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># dataframe missing data
</span><span class="n">ted</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="nb">sum</span><span class="p">()</span>
</code></pre></div></div>

<h1 id="selecting">Selecting</h1>
<h2 id="summary">Summary</h2>

<p>Select columns</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># dataframe select columns
</span>
<span class="n">s</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s">'col_label'</span><span class="p">]</span>  <span class="c1"># returns Series
</span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s">'col_label'</span><span class="p">]]</span> <span class="c1"># return DataFrame
</span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s">'L1'</span><span class="p">,</span> <span class="s">'L2'</span><span class="p">]]</span> <span class="c1"># select with list
</span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="c1"># select with index
</span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="c1">#select with Series
</span></code></pre></div></div>

<p>Select rows</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># dataframe select rows
</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s">'from'</span><span class="p">:</span><span class="s">'inc_to'</span><span class="p">]</span><span class="c1"># label slice
</span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="mi">7</span><span class="p">]</span> <span class="c1"># integer slice
</span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s">'col'</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.5</span><span class="p">]</span><span class="c1"># Boolean Series
</span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s">'label'</span><span class="p">]</span> <span class="c1"># single label
</span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">container</span><span class="p">]</span> <span class="c1"># lab list/Series
</span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s">'from'</span><span class="p">:</span><span class="s">'to'</span><span class="p">]</span><span class="c1"># inclusive slice
</span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">bs</span><span class="p">]</span> <span class="c1"># Boolean Series
</span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># single integer
</span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">container</span><span class="p">]</span> <span class="c1"># int list/Series
</span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">5</span><span class="p">]</span> <span class="c1"># exclusive slice
</span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">ix</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="c1"># loc then iloc
</span></code></pre></div></div>
<p>Select a cross-section (<a href="#top">top</a>)</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># dataframe select slices
</span>
<span class="c1"># r and c can be scalar, list, slice
</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">r</span><span class="p">,</span> <span class="n">c</span><span class="p">]</span> <span class="c1"># label accessor (row, col)
</span><span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">r</span><span class="p">,</span> <span class="n">c</span><span class="p">]</span><span class="c1"># integer accessor
</span><span class="n">df</span><span class="o">.</span><span class="n">ix</span><span class="p">[</span><span class="n">r</span><span class="p">,</span> <span class="n">c</span><span class="p">]</span> <span class="c1"># label access int fallback
</span><span class="n">df</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">r</span><span class="p">]</span><span class="c1"># chained – also for .loc
</span></code></pre></div></div>

<p>Select a cell (<a href="#top">top</a>)</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># dataframe select cell
# r and c must be label or integer
</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">r</span><span class="p">,</span> <span class="n">c</span><span class="p">]</span> <span class="c1"># fast scalar label accessor
</span><span class="n">df</span><span class="o">.</span><span class="n">iat</span><span class="p">[</span><span class="n">r</span><span class="p">,</span> <span class="n">c</span><span class="p">]</span> <span class="c1"># fast scalar int accessor
</span><span class="n">df</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">iat</span><span class="p">[</span><span class="n">r</span><span class="p">]</span> <span class="c1"># chained – also for .at
</span></code></pre></div></div>

<p>DataFrame indexing methods (<a href="#top">top</a>)</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">v</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span> <span class="c1"># get by row, col
</span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">v</span><span class="p">)</span><span class="c1"># set by row, col
</span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">xs</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">axis</span><span class="p">)</span> <span class="c1"># get cross-section
</span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="nb">filter</span><span class="p">(</span><span class="n">items</span><span class="p">,</span> <span class="n">like</span><span class="p">,</span> <span class="n">regex</span><span class="p">,</span> <span class="n">axis</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">crit</span><span class="p">,</span> <span class="n">axis</span><span class="p">)</span>
</code></pre></div></div>

<p>Some index attributes and methods (<a href="#top">top</a>)</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># dataframe index atrributes
</span>
<span class="c1"># --- some Index attributes
</span><span class="n">b</span> <span class="o">=</span> <span class="n">idx</span><span class="o">.</span><span class="n">is_monotonic_decreasing</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">idx</span><span class="o">.</span><span class="n">is_monotonic_increasing</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">idx</span><span class="o">.</span><span class="n">has_duplicates</span>
<span class="n">i</span> <span class="o">=</span> <span class="n">idx</span><span class="o">.</span><span class="n">nlevels</span> <span class="c1"># num of index levels
# --- some Index methods
</span><span class="n">idx</span> <span class="o">=</span> <span class="n">idx</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">dtype</span><span class="p">)</span><span class="c1"># change data type
</span><span class="n">b</span> <span class="o">=</span> <span class="n">idx</span><span class="o">.</span><span class="n">equals</span><span class="p">(</span><span class="n">o</span><span class="p">)</span> <span class="c1"># check for equality
</span><span class="n">idx</span> <span class="o">=</span> <span class="n">idx</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">o</span><span class="p">)</span> <span class="c1"># union of two indexes
</span><span class="n">i</span> <span class="o">=</span> <span class="n">idx</span><span class="o">.</span><span class="n">nunique</span><span class="p">()</span> <span class="c1"># number unique labels
</span><span class="n">label</span> <span class="o">=</span> <span class="n">idx</span><span class="o">.</span><span class="nb">min</span><span class="p">()</span> <span class="c1"># minimum label
</span><span class="n">label</span> <span class="o">=</span> <span class="n">idx</span><span class="o">.</span><span class="nb">max</span><span class="p">()</span> <span class="c1"># maximum label
</span></code></pre></div></div>

<h2 id="whole-dataframe">Whole DataFrame</h2>

<p>Content/Structure</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># dataframe get info
</span>
<span class="n">df</span><span class="o">.</span><span class="n">info</span><span class="p">()</span> <span class="c1"># index &amp; data types
</span><span class="n">dfh</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="c1"># get first i rows
</span><span class="n">dft</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="c1"># get last i rows
</span><span class="n">dfs</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span> <span class="c1"># summary stats cols
</span><span class="n">top_left_corner_df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="mi">4</span><span class="p">,</span> <span class="p">:</span><span class="mi">4</span><span class="p">]</span>
</code></pre></div></div>

<p>Non-indexing attributes (<a href="#top">top</a>)</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># dataframe non-indexing methods
</span>
<span class="n">dfT</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">T</span> <span class="c1"># transpose rows and cols
</span><span class="n">l</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">axes</span> <span class="c1"># list row and col indexes
</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">axes</span> <span class="c1"># from above
</span><span class="n">s</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">dtypes</span> <span class="c1"># Series column data types
</span><span class="n">b</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">empty</span> <span class="c1"># True for empty DataFrame
</span><span class="n">i</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">ndim</span> <span class="c1"># number of axes (it is 2)
</span><span class="n">t</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">shape</span> <span class="c1"># (row-count, column-count)
</span><span class="n">i</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">size</span> <span class="c1"># row-count * column-count
</span><span class="n">a</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">values</span> <span class="c1"># get a numpy array for df
</span></code></pre></div></div>

<p>Utilities - DataFrame utility methods (<a href="#top">top</a>)</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># dataframe sort
</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span> <span class="c1"># dataframe copy
</span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">rank</span><span class="p">()</span> <span class="c1"># rank each col (default)
</span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">sort</span><span class="p">([</span><span class="s">'sales'</span><span class="p">],</span> <span class="n">ascending</span><span class="o">=</span><span class="p">[</span><span class="bp">False</span><span class="p">])</span> 
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="n">col</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="n">col1</span><span class="p">,</span> <span class="n">col2</span><span class="p">])</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">sort_index</span><span class="p">()</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">dtype</span><span class="p">)</span> <span class="c1"># type conversion
</span></code></pre></div></div>

<p>Iterations (<a href="#top">top</a>)</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># dataframe iterate for
</span>
<span class="n">df</span><span class="o">.</span><span class="n">iteritems</span><span class="p">()</span><span class="c1"># (col-index, Series) pairs
</span><span class="n">df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">()</span> <span class="c1"># (row-index, Series) pairs
# example ... iterating over columns
</span><span class="k">for</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">series</span><span class="p">)</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
	<span class="k">print</span><span class="p">(</span><span class="s">'Col name: '</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
	<span class="k">print</span><span class="p">(</span><span class="s">'First value: '</span> <span class="o">+</span>
		<span class="nb">str</span><span class="p">(</span><span class="n">series</span><span class="o">.</span><span class="n">iat</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="s">'</span><span class="se">\n</span><span class="s">'</span><span class="p">)</span>
</code></pre></div></div>

<p>Maths (<a href="#top">top</a>)</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># dataframe math
</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="nb">abs</span><span class="p">()</span> <span class="c1"># absolute values
</span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">o</span><span class="p">)</span> <span class="c1"># add df, Series or value
</span><span class="n">s</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">count</span><span class="p">()</span> <span class="c1"># non NA/null values
</span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">cummax</span><span class="p">()</span> <span class="c1"># (cols default axis)
</span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">cummin</span><span class="p">()</span> <span class="c1"># (cols default axis)
</span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">cumsum</span><span class="p">()</span> <span class="c1"># (cols default axis)
</span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span> <span class="c1"># 1st diff (col def axis)
</span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">div</span><span class="p">(</span><span class="n">o</span><span class="p">)</span> <span class="c1"># div by df, Series, value
</span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">o</span><span class="p">)</span> <span class="c1"># matrix dot product
</span><span class="n">s</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="nb">max</span><span class="p">()</span> <span class="c1"># max of axis (col def)
</span><span class="n">s</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="c1"># mean (col default axis)
</span><span class="n">s</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">median</span><span class="p">()</span><span class="c1"># median (col default)
</span><span class="n">s</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="nb">min</span><span class="p">()</span> <span class="c1"># min of axis (col def)
</span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">mul</span><span class="p">(</span><span class="n">o</span><span class="p">)</span> <span class="c1"># mul by df Series val
</span><span class="n">s</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="nb">sum</span><span class="p">()</span> <span class="c1"># sum axis (cols default)
</span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">df</span> <span class="o">&gt;</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">other</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
</code></pre></div></div>
<p>Select/filter (<a href="#top">top</a>)</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># dataframe select filter
</span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="nb">filter</span><span class="p">(</span><span class="n">items</span><span class="o">=</span><span class="p">[</span><span class="s">'a'</span><span class="p">,</span> <span class="s">'b'</span><span class="p">])</span> <span class="c1"># by col
</span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="nb">filter</span><span class="p">(</span><span class="n">items</span><span class="o">=</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="c1">#by row
</span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="nb">filter</span><span class="p">(</span><span class="n">like</span><span class="o">=</span><span class="s">'x'</span><span class="p">)</span> <span class="c1"># keep x in col
</span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="nb">filter</span><span class="p">(</span><span class="n">regex</span><span class="o">=</span><span class="s">'x'</span><span class="p">)</span> <span class="c1"># regex in col
</span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="ow">not</span> <span class="n">x</span><span class="o">%</span><span class="mi">5</span><span class="p">)</span><span class="c1">#5th rows
</span></code></pre></div></div>

<h2 id="columns">Columns</h2>

<p>Index and labels (<a href="#top">top</a>)</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># dataframe get index
</span><span class="n">idx</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="c1"># get col index
</span><span class="n">label</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># first col label
</span><span class="n">l</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span> <span class="c1"># list col labels
</span></code></pre></div></div>

<p>Data type conversions (<a href="#top">top</a>)</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># dataframe convert column
</span>
<span class="n">st</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s">'col'</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span><span class="c1"># Series dtype
</span><span class="n">a</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s">'col'</span><span class="p">]</span><span class="o">.</span><span class="n">values</span> <span class="c1"># numpy array
</span><span class="n">pl</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s">'col'</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span> <span class="c1"># python list
</span></code></pre></div></div>
<p>Note: useful dtypes for Series conversion: int, float, str</p>

<p>Common column-wide methods/attributes (<a href="#top">top</a>)</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">value</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s">'col'</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span> <span class="c1"># type of column
</span><span class="n">value</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s">'col'</span><span class="p">]</span><span class="o">.</span><span class="n">size</span> <span class="c1"># col dimensions
</span><span class="n">value</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s">'col'</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">()</span><span class="c1"># non-NA count
</span><span class="n">value</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s">'col'</span><span class="p">]</span><span class="o">.</span><span class="nb">sum</span><span class="p">()</span>
<span class="n">value</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s">'col'</span><span class="p">]</span><span class="o">.</span><span class="n">prod</span><span class="p">()</span>
<span class="n">value</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s">'col'</span><span class="p">]</span><span class="o">.</span><span class="nb">min</span><span class="p">()</span> <span class="c1"># column min
</span><span class="n">value</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s">'col'</span><span class="p">]</span><span class="o">.</span><span class="nb">max</span><span class="p">()</span> <span class="c1"># column max
</span><span class="n">value</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s">'col'</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="c1"># also median()
</span><span class="n">value</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s">'col'</span><span class="p">]</span><span class="o">.</span><span class="n">cov</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s">'col2'</span><span class="p">])</span>
<span class="n">s</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s">'col'</span><span class="p">]</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
<span class="n">s</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s">'col'</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</code></pre></div></div>

<p>Find index label for min/max values in column (<a href="#top">top</a>)</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">label</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s">'col1'</span><span class="p">]</span><span class="o">.</span><span class="n">idxmin</span><span class="p">()</span>
<span class="n">label</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s">'col1'</span><span class="p">]</span><span class="o">.</span><span class="n">idxmax</span><span class="p">()</span>
</code></pre></div></div>

<p>Common column element-wise methods (<a href="#top">top</a>)</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">s</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s">'col'</span><span class="p">]</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span>
<span class="n">s</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s">'col'</span><span class="p">]</span><span class="o">.</span><span class="n">notnull</span><span class="p">()</span> <span class="c1"># not isnull()
</span><span class="n">s</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s">'col'</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
<span class="n">s</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s">'col'</span><span class="p">]</span><span class="o">.</span><span class="nb">abs</span><span class="p">()</span>
<span class="n">s</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s">'col'</span><span class="p">]</span><span class="o">.</span><span class="nb">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">s</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s">'col'</span><span class="p">]</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">periods</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">s</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s">'col'</span><span class="p">]</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="n">periods</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">s</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s">'col'</span><span class="p">]</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">()</span>
<span class="n">s</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s">'col'</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="c1"># replace NaN w 0
</span><span class="n">s</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s">'col'</span><span class="p">]</span><span class="o">.</span><span class="n">cumsum</span><span class="p">()</span>
<span class="n">s</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s">'col'</span><span class="p">]</span><span class="o">.</span><span class="n">cumprod</span><span class="p">()</span>
<span class="n">s</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s">'col'</span><span class="p">]</span><span class="o">.</span><span class="n">pct_change</span><span class="p">(</span><span class="n">periods</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="n">s</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s">'col'</span><span class="p">]</span><span class="o">.</span><span class="n">rolling_sum</span><span class="p">(</span><span class="n">periods</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">window</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
</code></pre></div></div>
<p>Note: also rolling_min(), rolling_max(), and many more.</p>

<p>Position of a column index label (<a href="#top">top</a>)</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">j</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">get_loc</span><span class="p">(</span><span class="s">'col_name'</span><span class="p">)</span>
</code></pre></div></div>

<p>Column index values unique/monotonic (<a href="#top">top</a>)</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">is_unique</span><span class="p">:</span> <span class="k">pass</span> <span class="c1"># ...
</span><span class="n">b</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">is_monotonic_increasing</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">is_monotonic_decreasing</span>
</code></pre></div></div>

<blockquote>
  <p>Selecting</p>
</blockquote>

<p>Columns (<a href="#top">top</a>)</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">s</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s">'colName'</span><span class="p">]</span> <span class="c1"># select col to Series
</span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s">'colName'</span><span class="p">]]</span> <span class="c1"># select col to df
</span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s">'a'</span><span class="p">,</span><span class="s">'b'</span><span class="p">]]</span> <span class="c1"># select 2 or more
</span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s">'c'</span><span class="p">,</span><span class="s">'a'</span><span class="p">,</span><span class="s">'b'</span><span class="p">]]</span><span class="c1"># change col order
</span><span class="n">s</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="c1"># select by number
</span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]]</span> <span class="c1"># by number
</span><span class="n">s</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">'c'</span><span class="p">)</span> <span class="c1"># get col &amp; drop from df
</span></code></pre></div></div>

<p>Columns with Python attributes (<a href="#top">top</a>)</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">s</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">a</span> <span class="c1"># same as s = df['a']
# cannot create new columns by attribute
</span><span class="n">df</span><span class="o">.</span><span class="n">existing_column</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">a</span> <span class="o">/</span> <span class="n">df</span><span class="o">.</span><span class="n">b</span>
<span class="n">df</span><span class="p">[</span><span class="s">'new_column'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">a</span> <span class="o">/</span> <span class="n">df</span><span class="o">.</span><span class="n">b</span>
</code></pre></div></div>

<p>Selecting columns with .loc, .iloc and .ix (<a href="#top">top</a>)</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s">'col1'</span><span class="p">:</span><span class="s">'col2'</span><span class="p">]</span> <span class="c1"># inclusive
</span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="c1"># exclusive
</span></code></pre></div></div>

<p>Conditional selection (<a href="#top">top</a>)</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s">'A &gt; C'</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s">'A &gt; 0'</span><span class="p">)</span> 
<span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s">'A &gt; 0 &amp; A &lt; 1'</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s">'A &gt; B | A &gt; C'</span><span class="p">)</span>
<span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s">'coverage'</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">50</span><span class="p">]</span> <span class="c1"># all rows where coverage is more than 50
</span><span class="n">df</span><span class="p">[(</span><span class="n">df</span><span class="p">[</span><span class="s">'deaths'</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">500</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s">'deaths'</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">50</span><span class="p">)]</span>
<span class="n">df</span><span class="p">[(</span><span class="n">df</span><span class="p">[</span><span class="s">'score'</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s">'score'</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">)]</span>
<span class="n">df</span><span class="p">[</span><span class="o">~</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s">'regiment'</span><span class="p">]</span> <span class="o">==</span> <span class="s">'Dragoons'</span><span class="p">)]</span> <span class="c1"># Select all the regiments not named "Dragoons"
</span><span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s">'age'</span><span class="p">]</span><span class="o">.</span><span class="n">notnull</span><span class="p">()</span> <span class="o">&amp;</span> <span class="n">df</span><span class="p">[</span><span class="s">'sex'</span><span class="p">]</span><span class="o">.</span><span class="n">notnull</span><span class="p">()]</span>  <span class="c1"># ignore the missing data points
</span></code></pre></div></div>

<p>(<a href="#top">top</a>)</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># is in 
</span><span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">value_list</span><span class="p">)]</span>   <span class="c1"># value_list = ['Tina', 'Molly', 'Jason']
</span><span class="n">df</span><span class="p">[</span><span class="o">~</span><span class="n">df</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">value_list</span><span class="p">)]</span>
</code></pre></div></div>

<p>Partial matching (<a href="#top">top</a>)</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="c1"># column contains
</span><span class="n">df2</span><span class="p">[</span><span class="n">df2</span><span class="o">.</span><span class="n">E</span><span class="o">.</span><span class="nb">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s">"tw|ou"</span><span class="p">)]</span>
<span class="c1"># column contains regex 
</span><span class="n">df</span><span class="p">[</span><span class="s">'raw'</span><span class="p">]</span><span class="o">.</span><span class="nb">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s">'....-..-..'</span><span class="p">,</span> <span class="n">regex</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>  <span class="c1"># regex
</span>
<span class="c1"># dataframe column list contains
</span><span class="n">selection</span> <span class="o">=</span> <span class="p">[</span><span class="s">'cat'</span><span class="p">,</span> <span class="s">'dog'</span><span class="p">]</span>
<span class="n">df</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">selection</span><span class="p">)</span><span class="o">.</span><span class="nb">any</span><span class="p">(</span><span class="mi">1</span><span class="p">)]</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">64</span><span class="p">]:</span> 
  <span class="n">molecule</span>            <span class="n">species</span>
<span class="mi">0</span>        <span class="n">a</span>              <span class="p">[</span><span class="n">dog</span><span class="p">]</span>
<span class="mi">2</span>        <span class="n">c</span>         <span class="p">[</span><span class="n">cat</span><span class="p">,</span> <span class="n">dog</span><span class="p">]</span>
<span class="mi">3</span>        <span class="n">d</span>  <span class="p">[</span><span class="n">cat</span><span class="p">,</span> <span class="n">horse</span><span class="p">,</span> <span class="n">pig</span><span class="p">]</span>

</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># dataframe column rename 
</span><span class="n">df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s">'old1'</span><span class="p">:</span><span class="s">'new1'</span><span class="p">,</span><span class="s">'old2'</span><span class="p">:</span><span class="s">'new2'</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s">'a'</span><span class="p">,</span> <span class="s">'b'</span><span class="p">]</span>
</code></pre></div></div>

<blockquote>
  <p>Manipulating</p>
</blockquote>

<p>Adding (<a href="#top">top</a>)</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df</span><span class="p">[</span><span class="s">'new_col'</span><span class="p">]</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">))</span>
<span class="n">df</span><span class="p">[</span><span class="s">'new_col'</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">))</span>
<span class="n">df</span><span class="p">[</span><span class="s">'random'</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">))</span>
<span class="n">df</span><span class="p">[</span><span class="s">'index_as_col'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span>
<span class="n">df1</span><span class="p">[[</span><span class="s">'b'</span><span class="p">,</span><span class="s">'c'</span><span class="p">]]</span> <span class="o">=</span> <span class="n">df2</span><span class="p">[[</span><span class="s">'e'</span><span class="p">,</span><span class="s">'f'</span><span class="p">]]</span>
<span class="n">df3</span> <span class="o">=</span> <span class="n">df1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">other</span><span class="o">=</span><span class="n">df2</span><span class="p">)</span>
</code></pre></div></div>

<p>Vectorised arithmetic on columns (<a href="#top">top</a>)</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df</span><span class="p">[</span><span class="s">'proportion'</span><span class="p">]</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s">'count'</span><span class="p">]</span><span class="o">/</span><span class="n">df</span><span class="p">[</span><span class="s">'total'</span><span class="p">]</span>
<span class="n">df</span><span class="p">[</span><span class="s">'percent'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s">'proportion'</span><span class="p">]</span> <span class="o">*</span> <span class="mf">100.0</span>
</code></pre></div></div>

<p>Append a column of row sums to a DataFrame (<a href="#top">top</a>)</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df</span><span class="p">[</span><span class="s">'Total'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="nb">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div></div>
<p>Apply numpy mathematical functions to columns (<a href="#top">top</a>)</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df</span><span class="p">[</span><span class="s">'log_data'</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s">'col1'</span><span class="p">])</span>
</code></pre></div></div>
<p>Set column values set based on criteria (<a href="#top">top</a>)</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df</span><span class="p">[</span><span class="s">'b'</span><span class="p">]</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s">'a'</span><span class="p">]</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s">'a'</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">,</span><span class="n">other</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">df</span><span class="p">[</span><span class="s">'d'</span><span class="p">]</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s">'a'</span><span class="p">]</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">b</span><span class="o">!=</span><span class="mi">0</span><span class="p">,</span><span class="n">other</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">c</span><span class="p">)</span>
</code></pre></div></div>

<p>Swapping (<a href="#top">top</a>)</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df</span><span class="p">[[</span><span class="s">'B'</span><span class="p">,</span> <span class="s">'A'</span><span class="p">]]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s">'A'</span><span class="p">,</span> <span class="s">'B'</span><span class="p">]]</span>
</code></pre></div></div>

<p>Dropping (<a href="#top">top</a>)</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s">'col1'</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s">'col1'</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s">'col1'</span><span class="p">,</span><span class="s">'col2'</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">s</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">'col'</span><span class="p">)</span> <span class="c1"># drops from frame
</span><span class="k">del</span> <span class="n">df</span><span class="p">[</span><span class="s">'col'</span><span class="p">]</span> <span class="c1"># even classic python works
</span><span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="c1"># drop columns with column names where the first three letters of the column names was 'pre'
</span><span class="n">cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">lower</span><span class="p">()[:</span><span class="mi">3</span><span class="p">]</span> <span class="o">!=</span> <span class="s">'pre'</span><span class="p">]</span>
<span class="n">df</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="n">cols</span><span class="p">]</span>
</code></pre></div></div>
<p>Multiply every column in DataFrame by Series (<a href="#top">top</a>)</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">mul</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="c1"># on matched rows
</span></code></pre></div></div>

<h2 id="rows">Rows</h2>

<p>Get Position (<a href="#top">top</a>)</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s">'col'</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">)</span> <span class="c1">#numpy array
</span></code></pre></div></div>

<p>DataFrames have same row index (<a href="#top">top</a>)</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="o">==</span><span class="nb">len</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">all</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">index</span><span class="o">==</span><span class="n">b</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>     <span class="c1"># Get the integer position of a row or col index label
</span><span class="n">i</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_loc</span><span class="p">(</span><span class="s">'row_label'</span><span class="p">)</span>
</code></pre></div></div>

<p>Row index values are unique/monotonic (<a href="#top">top</a>)</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">is_unique</span><span class="p">:</span> <span class="k">pass</span> <span class="c1"># ...
</span><span class="n">b</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">is_monotonic_increasing</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">is_monotonic_decreasing</span>
</code></pre></div></div>

<p>Get the row index and labels (<a href="#top">top</a>)</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">idx</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span>      <span class="c1"># get row index
</span><span class="n">label</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>    <span class="c1"># 1st row label
</span><span class="n">lst</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>     <span class="c1"># get as a list
</span></code></pre></div></div>

<p>Change the (row) index (<a href="#top">top</a>)</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">idx</span>     <span class="c1"># new ad hoc index
</span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s">'A'</span><span class="p">)</span>    <span class="c1"># col A new index
</span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s">'A'</span><span class="p">,</span> <span class="s">'B'</span><span class="p">])</span>    <span class="c1"># MultiIndex
</span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>   <span class="c1"># replace old w new
</span></code></pre></div></div>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">))</span> <span class="c1"># set with list
</span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)))</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="n">keys</span><span class="o">=</span><span class="p">[</span><span class="s">'r1'</span><span class="p">,</span><span class="s">'r2'</span><span class="p">,</span><span class="s">'etc'</span><span class="p">])</span>
<span class="n">df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="p">{</span><span class="s">'old'</span><span class="p">:</span><span class="s">'new'</span><span class="p">},</span><span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</code></pre></div></div>

<blockquote>
  <p>Selecting</p>
</blockquote>

<p>By column values (<a href="#top">top</a>)</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s">'col2'</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mf">0.0</span><span class="p">]</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[(</span><span class="n">df</span><span class="p">[</span><span class="s">'col3'</span><span class="p">]</span><span class="o">&gt;=</span><span class="mf">1.0</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s">'col1'</span><span class="p">]</span><span class="o">&lt;</span><span class="mf">0.0</span><span class="p">)]</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s">'col'</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">11</span><span class="p">])]</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="o">~</span><span class="n">df</span><span class="p">[</span><span class="s">'col'</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">11</span><span class="p">])]</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s">'col'</span><span class="p">]</span><span class="o">.</span><span class="nb">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s">'hello'</span><span class="p">)]</span>
</code></pre></div></div>
<p>Using isin over multiple columns (<a href="#top">top</a>)</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">## fake up some data
</span><span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">:[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span> <span class="mi">2</span><span class="p">:[</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">9</span><span class="p">],</span> <span class="mi">3</span><span class="p">:[</span><span class="mi">1</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">27</span><span class="p">]}</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="c1"># multi-column isin
</span><span class="n">lf</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">:[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="mi">3</span><span class="p">:[</span><span class="mi">8</span><span class="p">,</span> <span class="mi">27</span><span class="p">]}</span> <span class="c1"># look for
</span><span class="n">f</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">lf</span><span class="p">)]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">lf</span><span class="p">)</span><span class="o">.</span><span class="nb">all</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)]</span>
<span class="n">Selecting</span> <span class="n">rows</span> <span class="n">using</span> <span class="n">an</span> <span class="n">index</span>
<span class="n">idx</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s">'col'</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">index</span>
<span class="k">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">ix</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>
</code></pre></div></div>
<p>Slice of rows by integer position (<a href="#top">top</a>)</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">[</span><span class="n">inclusive</span><span class="o">-</span><span class="k">from</span> <span class="p">:</span> <span class="n">exclusive</span><span class="o">-</span><span class="n">to</span> <span class="p">[:</span> <span class="n">step</span><span class="p">]]</span>
<span class="n">default</span> <span class="n">start</span> <span class="ow">is</span> <span class="mi">0</span><span class="p">;</span> <span class="n">default</span> <span class="n">end</span> <span class="ow">is</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[:]</span> <span class="c1"># copy DataFrame
</span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="c1"># rows 0 and 1
</span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">:]</span> <span class="c1"># the last row
</span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span> <span class="c1"># row 2 (the third row)
</span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="c1"># all but the last row
</span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[::</span><span class="mi">2</span><span class="p">]</span> <span class="c1"># every 2nd row (0 2 ..)
</span></code></pre></div></div>

<p>Slice of rows by label/index (<a href="#top">top</a>)</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">[</span><span class="n">inclusive</span><span class="o">-</span><span class="k">from</span> <span class="p">:</span> <span class="n">inclusive</span><span class="err">–</span><span class="n">to</span> <span class="p">[</span> <span class="p">:</span> <span class="n">step</span><span class="p">]]</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s">'a'</span><span class="p">:</span><span class="s">'c'</span><span class="p">]</span> <span class="c1"># rows 'a' through 'c'
</span></code></pre></div></div>

<blockquote>
  <p>Manipulating</p>
</blockquote>

<p>Adding rows</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df</span> <span class="o">=</span> <span class="n">original_df</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">more_rows_in_df</span><span class="p">)</span>
</code></pre></div></div>

<p>Append a row of column totals to a DataFrame (<a href="#top">top</a>)</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Option 1: use dictionary comprehension
</span><span class="n">sums</span> <span class="o">=</span> <span class="p">{</span><span class="n">col</span><span class="p">:</span> <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="nb">sum</span><span class="p">()</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">df</span><span class="p">}</span>
<span class="n">sums_df</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">(</span><span class="n">sums</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s">'Total'</span><span class="p">])</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sums_df</span><span class="p">)</span>
<span class="c1"># Option 2: All done with pandas
</span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="nb">sum</span><span class="p">(),</span>
				<span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s">'Total'</span><span class="p">])</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
</code></pre></div></div>

<p>Dropping rows (by name) (<a href="#top">top</a>)</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s">'row_label'</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s">'row1'</span><span class="p">,</span><span class="s">'row2'</span><span class="p">])</span> <span class="c1"># multi-row
</span></code></pre></div></div>
<p>Drop duplicates in the row index (<a href="#top">top</a>)</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df</span><span class="p">[</span><span class="s">'index'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span> <span class="c1"># 1 create new col
</span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">cols</span><span class="o">=</span><span class="s">'index'</span><span class="p">,</span><span class="n">take_last</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span><span class="c1"># 2 use new col
</span><span class="k">del</span> <span class="n">df</span><span class="p">[</span><span class="s">'index'</span><span class="p">]</span> <span class="c1"># 3 del the col
</span><span class="n">df</span><span class="o">.</span><span class="n">sort_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span><span class="c1"># 4 tidy up
</span></code></pre></div></div>

<p>Iterating over DataFrame rows (<a href="#top">top</a>)</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span> <span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">row</span><span class="p">)</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span> <span class="c1"># pass
</span></code></pre></div></div>

<blockquote>
  <p>Sorting</p>
</blockquote>

<p>Rows values (<a href="#top">top</a>)</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ascending</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">sort</span><span class="p">([</span><span class="s">'col1'</span><span class="p">,</span> <span class="s">'col2'</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</code></pre></div></div>
<p>By row index (<a href="#top">top</a>)</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df</span><span class="o">.</span><span class="n">sort_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span> <span class="c1"># sort by row
</span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">sort_index</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</code></pre></div></div>

<p>Random (<a href="#top">top</a>)</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">random</span> <span class="k">as</span> <span class="n">r</span>
<span class="n">k</span> <span class="o">=</span> <span class="mi">20</span> <span class="c1"># pick a number
</span><span class="n">selection</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)),</span> <span class="n">k</span><span class="p">)</span>
<span class="n">df_sample</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">selection</span><span class="p">,</span> <span class="p">:]</span>
</code></pre></div></div>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">permutation</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">))[:</span><span class="mi">3</span><span class="p">])</span>
</code></pre></div></div>

<h2 id="cells">Cells</h2>

<blockquote>
  <p>Selecting</p>
</blockquote>

<p>By row and column (<a href="#top">top</a>)</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">value</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="s">'row'</span><span class="p">,</span> <span class="s">'col'</span><span class="p">]</span>
<span class="n">value</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s">'row'</span><span class="p">,</span> <span class="s">'col'</span><span class="p">]</span>
<span class="n">value</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s">'col'</span><span class="p">]</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="s">'row'</span><span class="p">]</span> <span class="c1"># tricky
</span></code></pre></div></div>
<p>Note: .at[] fastest label based scalar lookup</p>

<p>By integer position (<a href="#top">top</a>)</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">value</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">iat</span><span class="p">[</span><span class="mi">9</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="c1"># [row, col]
</span><span class="n">value</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="c1"># [row, col]
</span><span class="n">value</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>
<span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</code></pre></div></div>

<p>Slice by labels (<a href="#top">top</a>)</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s">'row1'</span><span class="p">:</span><span class="s">'row3'</span><span class="p">,</span> <span class="s">'col1'</span><span class="p">:</span><span class="s">'col3'</span><span class="p">]</span>
</code></pre></div></div>
<p>Slice by Integer Position (<a href="#top">top</a>)</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span> <span class="c1"># subset of the df
</span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="mi">5</span><span class="p">,</span> <span class="p">:</span><span class="mi">5</span><span class="p">]</span> <span class="c1"># top left corner
</span><span class="n">s</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="p">:]</span> <span class="c1"># returns row as Series
</span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">5</span><span class="p">:</span><span class="mi">6</span><span class="p">,</span> <span class="p">:]</span> <span class="c1"># returns row as row
</span></code></pre></div></div>
<p>By label and/or Index (<a href="#top">top</a>)</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">value</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">ix</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="s">'col1'</span><span class="p">]</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">ix</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">5</span><span class="p">,</span> <span class="s">'col1'</span><span class="p">:</span><span class="s">'col3'</span><span class="p">]</span>
</code></pre></div></div>

<blockquote>
  <p>Manipulating</p>
</blockquote>

<p>Setting a cell by row and column labels (<a href="#top">top</a>)</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># pandas update 
</span>
<span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="s">'row'</span><span class="p">,</span> <span class="s">'col'</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
<span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s">'row'</span><span class="p">,</span> <span class="s">'col'</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
<span class="n">df</span><span class="p">[</span><span class="s">'col'</span><span class="p">]</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="s">'row'</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span> <span class="c1"># tricky
</span></code></pre></div></div>
<p>Setting a cross-section by labels</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s">'A'</span><span class="p">:</span><span class="s">'C'</span><span class="p">,</span> <span class="s">'col1'</span><span class="p">:</span><span class="s">'col3'</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
<span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="s">'col1'</span><span class="p">:</span><span class="s">'col2'</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
<span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="s">'A'</span><span class="p">:</span><span class="s">'C'</span><span class="p">]</span><span class="o">=</span><span class="n">othr</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="s">'A'</span><span class="p">:</span><span class="s">'C'</span><span class="p">]</span>
</code></pre></div></div>

<p>Setting cell by integer position</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span> <span class="c1"># [row, col]
</span><span class="n">df</span><span class="o">.</span><span class="n">iat</span><span class="p">[</span><span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
</code></pre></div></div>

<p>Setting cell range by integer position</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
<span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">]])</span>
</code></pre></div></div>

<h1 id="data-wrangling">Data wrangling</h1>
<h2 id="merge-join">Merge Join</h2>

<p>More examples: <a href="https://www.geeksforgeeks.org/python-pandas-merging-joining-and-concatenating/">https://www.geeksforgeeks.org/python-pandas-merging-joining-and-concatenating/</a></p>

<p><img src="https://i.imgur.com/4x8V468.png" alt="drawing" width="400" /></p>

<p>(<a href="#top">top</a>)</p>

<p>Three ways to join two DataFrames:</p>
<ul>
  <li>merge (a database/SQL-like join operation)</li>
  <li>concat (stack side by side or one on top of the other)</li>
  <li>combine_first (splice the two together, choosing
values from one over the other)</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># pandas merge
</span>
<span class="c1"># Merge on indexes
</span><span class="n">df_new</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="n">df1</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="n">df2</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s">'outer'</span><span class="p">,</span> <span class="n">left_index</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">right_index</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="c1"># Merge on columns  
</span><span class="n">df_new</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="n">df1</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="n">df2</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s">'left'</span><span class="p">,</span> <span class="n">left_on</span><span class="o">=</span><span class="s">'col1'</span><span class="p">,</span> <span class="n">right_on</span><span class="o">=</span><span class="s">'col2'</span><span class="p">)</span>

<span class="c1"># Join on indexes (another way of merging)
</span><span class="n">df_new</span> <span class="o">=</span> <span class="n">df1</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">other</span><span class="o">=</span><span class="n">df2</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s">'col1'</span><span class="p">,</span><span class="n">how</span><span class="o">=</span><span class="s">'outer'</span><span class="p">)</span>
<span class="n">df_new</span> <span class="o">=</span> <span class="n">df1</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">other</span><span class="o">=</span><span class="n">df2</span><span class="p">,</span><span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s">'a'</span><span class="p">,</span><span class="s">'b'</span><span class="p">],</span><span class="n">how</span><span class="o">=</span><span class="s">'outer'</span><span class="p">)</span>

<span class="c1"># Simple concatenation is often the best
# pandas concat
</span><span class="n">df</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df1</span><span class="p">,</span><span class="n">df2</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="c1">#top/bottom
</span><span class="n">df</span> <span class="o">=</span> <span class="n">df1</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">df2</span><span class="p">,</span> <span class="n">df3</span><span class="p">])</span> <span class="c1">#top/bottom
</span><span class="n">df</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df1</span><span class="p">,</span><span class="n">df2</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="c1">#left/right
</span>
<span class="c1"># Combine_first (&lt;a href="#top"&gt;top&lt;/a&gt;) 
</span><span class="n">df</span> <span class="o">=</span> <span class="n">df1</span><span class="o">.</span><span class="n">combine_first</span><span class="p">(</span><span class="n">other</span><span class="o">=</span><span class="n">df2</span><span class="p">)</span>
<span class="c1"># multi-combine with python reduce()
</span><span class="n">df</span> <span class="o">=</span> <span class="nb">reduce</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span>
<span class="n">x</span><span class="o">.</span><span class="n">combine_first</span><span class="p">(</span><span class="n">y</span><span class="p">),</span>
<span class="p">[</span><span class="n">df1</span><span class="p">,</span> <span class="n">df2</span><span class="p">,</span> <span class="n">df3</span><span class="p">,</span> <span class="n">df4</span><span class="p">,</span> <span class="n">df5</span><span class="p">])</span>
</code></pre></div></div>

<p>(<a href="#top">top</a>)</p>

<h2 id="groupby">GroupBy</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># pandas groupby
# Grouping
</span><span class="n">gb</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s">'cat'</span><span class="p">)</span> <span class="c1"># by one columns
</span><span class="n">gb</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s">'c1'</span><span class="p">,</span><span class="s">'c2'</span><span class="p">])</span> <span class="c1"># by 2 cols
</span><span class="n">gb</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="c1"># multi-index gb
</span><span class="n">gb</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="p">[</span><span class="s">'a'</span><span class="p">,</span><span class="s">'b'</span><span class="p">])</span> <span class="c1"># mi gb
</span><span class="k">print</span><span class="p">(</span><span class="n">gb</span><span class="o">.</span><span class="n">groups</span><span class="p">)</span>

<span class="c1"># Iterating groups – usually not needed 
# pandas groupby iterate
</span><span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">gb</span><span class="p">:</span>
	<span class="k">print</span> <span class="p">(</span><span class="n">name</span><span class="p">)</span>
	<span class="k">print</span> <span class="p">(</span><span class="n">group</span><span class="p">)</span>

<span class="c1"># Selecting a group (&lt;a href="#top"&gt;top&lt;/a&gt;) 
</span><span class="n">dfa</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s">'cat'</span><span class="p">)</span><span class="o">.</span><span class="n">get_group</span><span class="p">(</span><span class="s">'a'</span><span class="p">)</span>
<span class="n">dfb</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s">'cat'</span><span class="p">)</span><span class="o">.</span><span class="n">get_group</span><span class="p">(</span><span class="s">'b'</span><span class="p">)</span>

<span class="c1"># pandas groupby aggregate
# Applying an aggregating function 
# apply to a column ...
</span><span class="n">s</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s">'cat'</span><span class="p">)[</span><span class="s">'col1'</span><span class="p">]</span><span class="o">.</span><span class="nb">sum</span><span class="p">()</span>
<span class="n">s</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s">'cat'</span><span class="p">)[</span><span class="s">'col1'</span><span class="p">]</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="nb">sum</span><span class="p">)</span>

<span class="c1"># apply to the every column in DataFrame
</span><span class="n">s</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s">'cat'</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="nb">sum</span><span class="p">)</span>
<span class="n">df_summary</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s">'cat'</span><span class="p">)</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
<span class="n">df_row_1s</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s">'cat'</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># Applying multiple aggregating functions 
</span><span class="n">gb</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s">'cat'</span><span class="p">)</span>
<span class="c1"># apply multiple functions to one column
</span><span class="n">dfx</span> <span class="o">=</span> <span class="n">gb</span><span class="p">[</span><span class="s">'col2'</span><span class="p">]</span><span class="o">.</span><span class="n">agg</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="nb">sum</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">])</span>
<span class="c1"># apply to multiple fns to multiple cols
</span><span class="n">dfy</span> <span class="o">=</span> <span class="n">gb</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span>
	<span class="s">'cat'</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">count_nonzero</span><span class="p">,</span>
	<span class="s">'col1'</span><span class="p">:</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="nb">sum</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">],</span>
	<span class="s">'col2'</span><span class="p">:</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="nb">min</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="nb">max</span><span class="p">]</span>
<span class="p">})</span>
<span class="n">Note</span><span class="p">:</span> <span class="n">gb</span><span class="p">[</span><span class="s">'col2'</span><span class="p">]</span> <span class="n">above</span> <span class="ow">is</span> <span class="n">shorthand</span> <span class="k">for</span>
<span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s">'cat'</span><span class="p">)[</span><span class="s">'col2'</span><span class="p">],</span> <span class="n">without</span> <span class="n">the</span> <span class="n">need</span> <span class="k">for</span> <span class="n">regrouping</span><span class="o">.</span>

<span class="c1"># Transforming functions (&lt;a href="#top"&gt;top&lt;/a&gt;) 
</span>
<span class="c1"># pandas groupby function
</span>
<span class="c1"># transform to group z-scores, which have
# a group mean of 0, and a std dev of 1.
</span><span class="n">zscore</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">x</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span><span class="o">/</span><span class="n">x</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
<span class="n">dfz</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s">'cat'</span><span class="p">)</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">zscore</span><span class="p">)</span>

<span class="c1"># pandas groupby fillna
</span>
<span class="c1"># replace missing data with group mean
</span><span class="n">mean_r</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
<span class="n">dfm</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s">'cat'</span><span class="p">)</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">mean_r</span><span class="p">)</span>

<span class="c1"># Applying filtering functions (&lt;a href="#top"&gt;top&lt;/a&gt;) 
# select groups with more than 10 members
</span><span class="n">eleven</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s">'col1'</span><span class="p">])</span> <span class="o">&gt;=</span> <span class="mi">11</span><span class="p">)</span>
<span class="n">df11</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s">'cat'</span><span class="p">)</span><span class="o">.</span><span class="nb">filter</span><span class="p">(</span><span class="n">eleven</span><span class="p">)</span>

<span class="c1"># Group by a row index (non-hierarchical index) 
</span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="n">keys</span><span class="o">=</span><span class="s">'cat'</span><span class="p">)</span>
<span class="n">s</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="mi">0</span><span class="p">)[</span><span class="s">'col1'</span><span class="p">]</span><span class="o">.</span><span class="nb">sum</span><span class="p">()</span>
<span class="n">dfg</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="nb">sum</span><span class="p">()</span>
</code></pre></div></div>

<p>(<a href="#top">top</a>)</p>

<h2 id="dates">Dates</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># pandas timestamp
# Dates and time – points and spans
</span><span class="n">t</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s">'2013-01-01'</span><span class="p">)</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s">'2013-01-01 21:15:06'</span><span class="p">)</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s">'2013-01-01 21:15:06.7'</span><span class="p">)</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Period</span><span class="p">(</span><span class="s">'2013-01-01'</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s">'M'</span><span class="p">)</span>

<span class="c1"># pandas time series
</span>
<span class="c1"># A Series of Timestamps or Periods 
</span><span class="n">ts</span> <span class="o">=</span> <span class="p">[</span><span class="s">'2015-04-01 13:17:27'</span><span class="p">,</span> <span class="s">'2014-04-02 13:17:29'</span><span class="p">]</span>
<span class="c1"># Series of Timestamps (good)
</span><span class="n">s</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">ts</span><span class="p">))</span>
<span class="c1"># Series of Periods (often not so good)
</span><span class="n">s</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span> <span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">Period</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s">'M'</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">ts</span><span class="p">]</span> <span class="p">)</span>
<span class="n">s</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">PeriodIndex</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span><span class="n">freq</span><span class="o">=</span><span class="s">'S'</span><span class="p">))</span>

<span class="c1"># From non-standard strings to Timestamps
</span><span class="n">t</span> <span class="o">=</span> <span class="p">[</span><span class="s">'09:08:55.7654-JAN092002'</span><span class="p">,</span> <span class="s">'15:42:02.6589-FEB082016'</span><span class="p">]</span>
<span class="n">s</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s">"</span><span class="si">%</span><span class="s">H:</span><span class="si">%</span><span class="s">M:</span><span class="si">%</span><span class="s">S.</span><span class="si">%</span><span class="s">f-</span><span class="si">%</span><span class="s">b</span><span class="si">%</span><span class="s">d</span><span class="si">%</span><span class="s">Y"</span><span class="p">))</span>

<span class="c1"># Dates and time – stamps and spans as indexes
</span>
<span class="c1"># pandas time periods
</span><span class="n">date_strs</span> <span class="o">=</span> <span class="p">[</span><span class="s">'2014-01-01'</span><span class="p">,</span> <span class="s">'2014-04-01'</span><span class="p">,</span><span class="s">'2014-07-01'</span><span class="p">,</span> <span class="s">'2014-10-01'</span><span class="p">]</span>
<span class="n">dti</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">(</span><span class="n">date_strs</span><span class="p">)</span>
<span class="n">pid</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">PeriodIndex</span><span class="p">(</span><span class="n">date_strs</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s">'D'</span><span class="p">)</span>
<span class="n">pim</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">PeriodIndex</span><span class="p">(</span><span class="n">date_strs</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s">'M'</span><span class="p">)</span>
<span class="n">piq</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">PeriodIndex</span><span class="p">(</span><span class="n">date_strs</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s">'Q'</span><span class="p">)</span>
<span class="k">print</span> <span class="p">(</span><span class="n">pid</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">pid</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="c1"># 90 days
</span><span class="k">print</span> <span class="p">(</span><span class="n">pim</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">pim</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="c1"># 3 months
</span><span class="k">print</span> <span class="p">(</span><span class="n">piq</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">piq</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="c1"># 1 quarter
</span><span class="n">time_strs</span> <span class="o">=</span> <span class="p">[</span><span class="s">'2015-01-01 02:10:40.12345'</span><span class="p">,</span>
<span class="s">'2015-01-01 02:10:50.67890'</span><span class="p">]</span>
<span class="n">pis</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">PeriodIndex</span><span class="p">(</span><span class="n">time_strs</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s">'U'</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">period_range</span><span class="p">(</span><span class="s">'2015-01'</span><span class="p">,</span>
<span class="n">periods</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">),</span> <span class="n">freq</span><span class="o">=</span><span class="s">'M'</span><span class="p">)</span>
<span class="n">dti</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">([</span><span class="s">'04-01-2012'</span><span class="p">],</span>
<span class="n">dayfirst</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span> <span class="c1"># Australian date format
</span><span class="n">pi</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">period_range</span><span class="p">(</span><span class="s">'1960-01-01'</span><span class="p">,</span><span class="s">'2015-12-31'</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s">'M'</span><span class="p">)</span>
<span class="c1"># Hint: unless you are working in less than seconds, prefer PeriodIndex over DateTimeImdex.
</span></code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># pandas converting times
</span><span class="n">From</span> <span class="n">DatetimeIndex</span> <span class="n">to</span> <span class="n">Python</span> <span class="n">datetime</span> <span class="n">objects</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">a</span> <span class="n">href</span><span class="o">=</span><span class="s">"#top"</span><span class="o">&gt;</span><span class="n">top</span><span class="o">&lt;/</span><span class="n">a</span><span class="o">&gt;</span><span class="p">)</span> 

<span class="n">dti</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span>
<span class="n">start</span><span class="o">=</span><span class="s">'1/1/2011'</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s">'M'</span><span class="p">))</span>
<span class="n">s</span> <span class="o">=</span> <span class="n">Series</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="n">dti</span><span class="p">)</span>
<span class="n">na</span> <span class="o">=</span> <span class="n">dti</span><span class="o">.</span><span class="n">to_pydatetime</span><span class="p">()</span> <span class="c1">#numpy array
</span><span class="n">na</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">to_pydatetime</span><span class="p">()</span> <span class="c1">#numpy array
</span>
<span class="c1"># From Timestamps to Python dates or times
</span><span class="n">df</span><span class="p">[</span><span class="s">'date'</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">date</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">df</span><span class="p">[</span><span class="s">'TS'</span><span class="p">]]</span>
<span class="n">df</span><span class="p">[</span><span class="s">'time'</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">df</span><span class="p">[</span><span class="s">'TS'</span><span class="p">]]</span>

<span class="c1"># From DatetimeIndex to PeriodIndex and back
</span><span class="n">df</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
<span class="n">df</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s">'2015-01-01'</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">),</span> <span class="n">freq</span><span class="o">=</span><span class="s">'M'</span><span class="p">)</span>
<span class="n">dfp</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">to_period</span><span class="p">(</span><span class="n">freq</span><span class="o">=</span><span class="s">'M'</span><span class="p">)</span>
<span class="n">dft</span> <span class="o">=</span> <span class="n">dfp</span><span class="o">.</span><span class="n">to_timestamp</span><span class="p">()</span>

<span class="c1"># Working with a PeriodIndex (&lt;a href="#top"&gt;top&lt;/a&gt;) 
</span><span class="n">pi</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">period_range</span><span class="p">(</span><span class="s">'1960-01'</span><span class="p">,</span><span class="s">'2015-12'</span><span class="p">,</span><span class="n">freq</span><span class="o">=</span><span class="s">'M'</span><span class="p">)</span>
<span class="n">na</span> <span class="o">=</span> <span class="n">pi</span><span class="o">.</span><span class="n">values</span> <span class="c1"># numpy array of integers
</span><span class="n">lp</span> <span class="o">=</span> <span class="n">pi</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span> <span class="c1"># python list of Periods
</span><span class="n">sp</span> <span class="o">=</span> <span class="n">Series</span><span class="p">(</span><span class="n">pi</span><span class="p">)</span><span class="c1"># pandas Series of Periods
</span><span class="n">ss</span> <span class="o">=</span> <span class="n">Series</span><span class="p">(</span><span class="n">pi</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span> <span class="c1"># S of strs
</span><span class="n">ls</span> <span class="o">=</span> <span class="n">Series</span><span class="p">(</span><span class="n">pi</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

<span class="c1"># Get a range of Timestamps
</span><span class="n">dr</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s">'2013-01-01'</span><span class="p">,</span> <span class="s">'2013-12-31'</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s">'D'</span><span class="p">)</span>

<span class="c1"># Error handling with dates
# 1st example returns string not Timestamp
</span><span class="n">t</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="s">'2014-02-30'</span><span class="p">)</span>
<span class="c1"># 2nd example returns NaT (not a time)
</span><span class="n">t</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="s">'2014-02-30'</span><span class="p">,</span><span class="nb">coerce</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="c1"># NaT like NaN tests True for isnull()
</span><span class="n">b</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">isnull</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="c1"># --&gt; True
</span>
<span class="c1"># The tail of a time-series DataFrame (&lt;a href="#top"&gt;top&lt;/a&gt;) 
</span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">last</span><span class="p">(</span><span class="s">"5M"</span><span class="p">)</span> <span class="c1"># the last five months
</span></code></pre></div></div>

<p>Upsampling and downsampling</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># pandas upsample pandas downsample
# upsample from quarterly to monthly
</span><span class="n">pi</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">period_range</span><span class="p">(</span><span class="s">'1960Q1'</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">220</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s">'Q'</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pi</span><span class="p">),</span><span class="mi">5</span><span class="p">),</span>
<span class="n">index</span><span class="o">=</span><span class="n">pi</span><span class="p">)</span>
<span class="n">dfm</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s">'M'</span><span class="p">,</span> <span class="n">convention</span><span class="o">=</span><span class="s">'end'</span><span class="p">)</span>
<span class="c1"># use ffill or bfill to fill with values
# downsample from monthly to quarterly
</span><span class="n">dfq</span> <span class="o">=</span> <span class="n">dfm</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s">'Q'</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s">'sum'</span><span class="p">)</span>
</code></pre></div></div>

<p>Time zones</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># pandas time zones
</span>
<span class="n">t</span> <span class="o">=</span> <span class="p">[</span><span class="s">'2015-06-30 00:00:00'</span><span class="p">,</span><span class="s">'2015-12-31 00:00:00'</span><span class="p">]</span>
<span class="n">dti</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">.</span><span class="n">tz_localize</span><span class="p">(</span><span class="s">'Australia/Canberra'</span><span class="p">)</span>
<span class="n">dti</span> <span class="o">=</span> <span class="n">dti</span><span class="o">.</span><span class="n">tz_convert</span><span class="p">(</span><span class="s">'UTC'</span><span class="p">)</span>
<span class="n">ts</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s">'now'</span><span class="p">,</span>
<span class="n">tz</span><span class="o">=</span><span class="s">'Europe/London'</span><span class="p">)</span>
<span class="c1"># get a list of all time zones
</span><span class="kn">import</span> <span class="nn">pyzt</span>
<span class="k">for</span> <span class="n">tz</span> <span class="ow">in</span> <span class="n">pytz</span><span class="o">.</span><span class="n">all_timezones</span><span class="p">:</span>
	<span class="k">print</span> <span class="n">tz</span>
<span class="c1"># Note: by default, Timestamps are created without timezone information.
</span>

<span class="c1"># Row selection with a time-series index
# start with the play data above
</span><span class="n">idx</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">period_range</span><span class="p">(</span><span class="s">'2015-01'</span><span class="p">,</span>
<span class="n">periods</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">),</span> <span class="n">freq</span><span class="o">=</span><span class="s">'M'</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">idx</span>
<span class="n">february_selector</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">month</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">february_data</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">february_selector</span><span class="p">]</span>
<span class="n">q1_data</span> <span class="o">=</span> <span class="n">df</span><span class="p">[(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">month</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">month</span> <span class="o">&lt;=</span> <span class="mi">3</span><span class="p">)]</span>
<span class="n">mayornov_data</span> <span class="o">=</span> <span class="n">df</span><span class="p">[(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">month</span> <span class="o">==</span> <span class="mi">5</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">month</span> <span class="o">==</span> <span class="mi">11</span><span class="p">)]</span>
<span class="n">totals</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">year</span><span class="p">)</span><span class="o">.</span><span class="nb">sum</span><span class="p">()</span>

<span class="c1"># The Series.dt accessor attribute
</span><span class="n">t</span> <span class="o">=</span> <span class="p">[</span><span class="s">'2012-04-14 04:06:56.307000'</span><span class="p">,</span> <span class="s">'2011-05-14 06:14:24.457000'</span><span class="p">,</span> <span class="s">'2010-06-14 08:23:07.520000'</span><span class="p">]</span>
<span class="c1"># a Series of time stamps
</span><span class="n">s</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span> <span class="c1"># datetime64[ns]
</span><span class="k">print</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">second</span><span class="p">)</span> <span class="c1"># 56, 24, 7
</span><span class="k">print</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">month</span><span class="p">)</span> <span class="c1"># 4, 5, 6
# a Series of time periods
</span><span class="n">s</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">PeriodIndex</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">freq</span><span class="o">=</span><span class="s">'Q'</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span> <span class="c1"># datetime64[ns]
</span><span class="k">print</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">quarter</span><span class="p">)</span> <span class="c1"># 2, 2, 2
</span><span class="k">print</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span><span class="p">)</span> <span class="c1"># 2012, 2011, 2010
</span></code></pre></div></div>

<h2 id="missing-data">Missing data</h2>

<p>Missing data in a Series (<a href="#top">top</a>)</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># pandas missing data series
</span><span class="n">s</span> <span class="o">=</span> <span class="n">Series</span><span class="p">(</span> <span class="p">[</span><span class="mi">8</span><span class="p">,</span><span class="bp">None</span><span class="p">,</span><span class="nb">float</span><span class="p">(</span><span class="s">'nan'</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">])</span>
<span class="c1">#[8, NaN, NaN, NaN]
</span><span class="n">s</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span> <span class="c1">#[False, True, True, True]
</span><span class="n">s</span><span class="o">.</span><span class="n">notnull</span><span class="p">()</span><span class="c1">#[True, False, False, False]
</span><span class="n">s</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="c1">#[8, 0, 0, 0]
</span></code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># pandas missing data dataframe
</span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span> <span class="c1"># drop all rows with NaN
</span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># same for cols
</span><span class="n">df</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">how</span><span class="o">=</span><span class="s">'all'</span><span class="p">)</span> <span class="c1">#drop all NaN row
</span><span class="n">df</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">thresh</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span> <span class="c1"># drop 2+ NaN in r
# only drop row if NaN in a specified col
</span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s">'col'</span><span class="p">]</span><span class="o">.</span><span class="n">notnull</span><span class="p">())</span>
</code></pre></div></div>

<h4 id="recodingreplacing-missing-data">Recoding/Replacing missing data</h4>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># pandas fillna recoding replacing
</span><span class="n">df</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span> <span class="c1"># np.nan -&gt; 0
</span><span class="n">s</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s">'col'</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="c1"># np.nan -&gt; 0
</span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">r'\s+'</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span><span class="n">regex</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span> <span class="c1"># white space -&gt; np.nan
# Non-finite numbers
</span><span class="n">s</span> <span class="o">=</span> <span class="n">Series</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="s">'inf'</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="s">'-inf'</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">])</span>
<span class="c1"># Testing for finite numbers (&lt;a href="#top"&gt;top&lt;/a&gt;) 
</span><span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
</code></pre></div></div>

<p>(<a href="#top">top</a>)</p>

<h2 id="categorical-data">Categorical Data</h2>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># pandas categorical data 
</span><span class="n">s</span> <span class="o">=</span> <span class="n">Series</span><span class="p">([</span><span class="s">'a'</span><span class="p">,</span><span class="s">'b'</span><span class="p">,</span><span class="s">'a'</span><span class="p">,</span><span class="s">'c'</span><span class="p">,</span><span class="s">'b'</span><span class="p">,</span><span class="s">'d'</span><span class="p">,</span><span class="s">'a'</span><span class="p">],</span>
<span class="n">dtype</span><span class="o">=</span><span class="s">'category'</span><span class="p">)</span>
<span class="n">df</span><span class="p">[</span><span class="s">'B'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s">'A'</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s">'category'</span><span class="p">)</span>

<span class="c1"># Convert back to the original data type
</span><span class="n">s</span> <span class="o">=</span> <span class="n">Series</span><span class="p">([</span><span class="s">'a'</span><span class="p">,</span><span class="s">'b'</span><span class="p">,</span><span class="s">'a'</span><span class="p">,</span><span class="s">'c'</span><span class="p">,</span><span class="s">'b'</span><span class="p">,</span><span class="s">'d'</span><span class="p">,</span><span class="s">'a'</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s">'category'</span><span class="p">)</span>
<span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s">'string'</span><span class="p">)</span>

<span class="c1"># Ordering, reordering and sorting
</span><span class="n">s</span> <span class="o">=</span> <span class="n">Series</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="s">'abc'</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="s">'category'</span><span class="p">)</span>
<span class="k">print</span> <span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">cat</span><span class="o">.</span><span class="n">ordered</span><span class="p">)</span>
<span class="n">s</span><span class="o">=</span><span class="n">s</span><span class="o">.</span><span class="n">cat</span><span class="o">.</span><span class="n">reorder_categories</span><span class="p">([</span><span class="s">'b'</span><span class="p">,</span><span class="s">'c'</span><span class="p">,</span><span class="s">'a'</span><span class="p">])</span>
<span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
<span class="n">s</span><span class="o">.</span><span class="n">cat</span><span class="o">.</span><span class="n">ordered</span> <span class="o">=</span> <span class="bp">False</span>

<span class="c1"># Renaming categories (&lt;a href="#top"&gt;top&lt;/a&gt;) 
</span><span class="n">s</span> <span class="o">=</span> <span class="n">Series</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="s">'abc'</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="s">'category'</span><span class="p">)</span>
<span class="n">s</span><span class="o">.</span><span class="n">cat</span><span class="o">.</span><span class="n">categories</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="c1"># in place
</span><span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">cat</span><span class="o">.</span><span class="n">rename_categories</span><span class="p">([</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">])</span>
<span class="c1"># using a comprehension ...
</span><span class="n">s</span><span class="o">.</span><span class="n">cat</span><span class="o">.</span><span class="n">categories</span> <span class="o">=</span> <span class="p">[</span><span class="s">'Group '</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
	<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">cat</span><span class="o">.</span><span class="n">categories</span><span class="p">]</span>

<span class="c1"># Adding new categories (&lt;a href="#top"&gt;top&lt;/a&gt;) 
</span><span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">cat</span><span class="o">.</span><span class="n">add_categories</span><span class="p">([</span><span class="mi">4</span><span class="p">])</span>

<span class="c1"># Removing categories (&lt;a href="#top"&gt;top&lt;/a&gt;) 
</span><span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">cat</span><span class="o">.</span><span class="n">remove_categories</span><span class="p">([</span><span class="mi">4</span><span class="p">])</span>
<span class="n">s</span><span class="o">.</span><span class="n">cat</span><span class="o">.</span><span class="n">remove_unused_categories</span><span class="p">()</span> <span class="c1">#inplace
</span></code></pre></div></div>
<p>(<a href="#top">top</a>)</p>

<h2 id="manipulations-and-cleaning">Manipulations and Cleaning</h2>

<h3 id="conversions">Conversions</h3>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="c1"># pandas convert to numeric
## errors='ignore'` 
## `errors='coerce` convert to  `np.nan`
</span> 
<span class="c1">## mess up data
</span><span class="n">invoices</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">45612</span><span class="p">,</span><span class="s">'Meal Price'</span><span class="p">]</span> <span class="o">=</span> <span class="s">'I am causing trouble'</span>  
<span class="n">invoices</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">35612</span><span class="p">,</span><span class="s">'Meal Price'</span><span class="p">]</span> <span class="o">=</span> <span class="s">'Me too'</span>

<span class="c1"># check if conversion worked
</span><span class="n">invoices</span><span class="p">[</span><span class="s">'Meal Price'</span><span class="p">]</span><span class="o">.</span><span class="nb">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="nb">type</span><span class="p">(</span><span class="n">x</span><span class="p">))</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
<span class="o">**</span><span class="n">OUT</span><span class="p">:</span>  
<span class="o">&lt;</span><span class="k">class</span> <span class="err">'</span><span class="nc">int</span><span class="s">'&gt; 49972  </span><span class="err">
</span><span class="s">&lt;class '</span><span class="nb">str</span><span class="s">'&gt; 2</span><span class="err">

</span><span class="s"># identify validating lines</span><span class="err">
</span><span class="s">invoices['</span><span class="n">Meal</span> <span class="n">Price</span><span class="s">'][invoices['</span><span class="n">Meal</span> <span class="n">Price</span><span class="s">'].apply(  </span><span class="err">
</span><span class="s">lambda x: isinstance(x,str)  )]</span><span class="err">
</span></code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># convert messy numerical data
</span>
<span class="c1">## convert the offending values into np.nan**  
</span><span class="n">invoices</span><span class="p">[</span><span class="s">'Meal Price'</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">invoices</span><span class="p">[</span><span class="s">'Meal Price'</span><span class="p">],</span><span class="n">errors</span><span class="o">=</span><span class="s">'coerce'</span><span class="p">)</span>

<span class="c1">## fill np.nan with the median of the data**  
</span><span class="n">invoices</span><span class="p">[</span><span class="s">'Meal Price'</span><span class="p">]</span> <span class="o">=</span> <span class="n">invoices</span><span class="p">[</span><span class="s">'Meal Price'</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">invoices</span><span class="p">[</span><span class="s">'Meal Price'</span><span class="p">]</span><span class="o">.</span><span class="n">median</span><span class="p">())</span>

<span class="c1">## convert the column into integer**  
</span><span class="n">invoices</span><span class="p">[</span><span class="s">'Meal Price'</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># pandas convert to datetime to_datetime
</span><span class="k">print</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="s">'2019-8-1'</span><span class="p">))</span>  
<span class="k">print</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="s">'2019/8/1'</span><span class="p">))</span>  
<span class="k">print</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="s">'8/1/2019'</span><span class="p">))</span>  
<span class="k">print</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="s">'Aug, 1 2019'</span><span class="p">))</span>  
<span class="k">print</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="s">'Aug - 1 2019'</span><span class="p">))</span>  
<span class="k">print</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="s">'August - 1 2019'</span><span class="p">))</span>  
<span class="k">print</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="s">'2019, August - 1'</span><span class="p">))</span>  
<span class="k">print</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="s">'20190108'</span><span class="p">))</span>

</code></pre></div></div>

<p>source: <a href="https://towardsdatascience.com/learn-advanced-features-for-pythons-main-data-analysis-library-in-20-minutes-d0eedd90d086">https://towardsdatascience.com/learn-advanced-features-for-pythons-main-data-analysis-library-in-20-minutes-d0eedd90d086</a></p>

<h3 id="method-chaining">Method chaining</h3>
<p><a href="https://towardsdatascience.com/the-unreasonable-effectiveness-of-method-chaining-in-pandas-15c2109e3c69">https://towardsdatascience.com/the-unreasonable-effectiveness-of-method-chaining-in-pandas-15c2109e3c69</a>
R to python: <a href="https://gist.github.com/conormm/fd8b1980c28dd21cfaf6975c86c74d07">gist</a></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># method chaining
</span><span class="k">def</span> <span class="nf">csnap</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">fn</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
<span class="s">""" Custom Help function to print things in method chaining.
Returns back the df to further use in chaining.
"""</span>
   <span class="k">if</span> <span class="n">msg</span><span class="p">:</span>
      <span class="k">print</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
      <span class="n">display</span><span class="p">(</span><span class="n">fn</span><span class="p">(</span><span class="n">df</span><span class="p">))</span>
   <span class="k">return</span> <span class="n">df</span>

<span class="p">(</span>
<span class="n">wine</span><span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">csnap</span><span class="p">)</span>
<span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s">"color_intensity"</span><span class="p">:</span> <span class="s">"ci"</span><span class="p">})</span>
<span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">color_filter</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">x</span><span class="o">.</span><span class="n">hue</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">ci</span> <span class="o">&gt;</span> <span class="mi">7</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
<span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">csnap</span><span class="p">)</span>
<span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s">"alcohol &gt; 14"</span><span class="p">)</span>
<span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">csnap</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">df</span><span class="p">:</span> <span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">(),</span> <span class="n">msg</span><span class="o">=</span><span class="s">"After"</span><span class="p">)</span>
<span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s">"alcohol"</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="p">[</span><span class="s">"alcohol"</span><span class="p">,</span> <span class="s">"ci"</span><span class="p">,</span> <span class="s">"hue"</span><span class="p">]]</span>
<span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">csnap</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>
<span class="p">)</span>
</code></pre></div></div>
<p>good explanation: <a href="https://tomaugspurger.github.io/method-chaining.html">https://tomaugspurger.github.io/method-chaining.html</a></p>
<ul>
  <li><a href="http://pandas.pydata.org/pandas-docs/stable/generated/pandas.DataFrame.assign.html">assign</a>  (0.16.0): For adding new columns to a DataFrame in a chain (inspired by dplyr’s  <code class="highlighter-rouge">mutate</code>)</li>
  <li><a href="http://pandas.pydata.org/pandas-docs/stable/generated/pandas.DataFrame.pipe.html">pipe</a>  (0.16.2): For including user-defined methods in method chains.</li>
  <li><a href="http://pandas.pydata.org/pandas-docs/version/0.18.0/whatsnew.html#changes-to-rename">rename</a>  (0.18.0): For altering axis names (in additional to changing the actual labels as before).</li>
  <li><a href="http://pandas.pydata.org/pandas-docs/version/0.18.0/whatsnew.html#window-functions-are-now-methods">Window methods</a>  (0.18): Took the top-level  <code class="highlighter-rouge">pd.rolling_*</code>  and  <code class="highlighter-rouge">pd.expanding_*</code>  functions and made them  <code class="highlighter-rouge">NDFrame</code>  methods with a  <code class="highlighter-rouge">groupby</code>-like API.</li>
  <li><a href="http://pandas.pydata.org/pandas-docs/version/0.18.0/whatsnew.html#resample-api">Resample</a>  (0.18.0) Added a new  <code class="highlighter-rouge">groupby</code>-like API</li>
  <li><a href="https://github.com/pydata/pandas/pull/12539">.where/mask/Indexers accept Callables</a>  (0.18.1): In the next release you’ll be able to pass a callable to the indexing methods, to be evaluated within the DataFrame’s context (like  <code class="highlighter-rouge">.query</code>, but with code instead of strings).</li>
</ul>

<p><a href="https://www.quora.com/I-love-the-flexibility-of-pandas-dataframes-but-I-feel-like-they-can-make-code-harder-to-read-and-maintain-What-are-some-pandas-best-practices-that-address-this-issue">https://www.quora.com/I-love-the-flexibility-of-pandas-dataframes-but-I-feel-like-they-can-make-code-harder-to-read-and-maintain-What-are-some-pandas-best-practices-that-address-this-issue</a></p>

<p>Tidyverse vs pandas: <a href="https://stmorse.github.io/journal/tidyverse-style-pandas.html">link</a></p>

<p>(<a href="#top">top</a>)</p>

<h3 id="binning">Binning</h3>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># binning
</span><span class="n">pd</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">3</span><span class="p">]),</span> <span class="mi">3</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="s">"bad"</span><span class="p">,</span> <span class="s">"medium"</span><span class="p">,</span> <span class="s">"good"</span><span class="p">])</span>
<span class="p">[</span><span class="n">bad</span><span class="p">,</span> <span class="n">good</span><span class="p">,</span> <span class="n">medium</span><span class="p">,</span> <span class="n">medium</span><span class="p">,</span> <span class="n">good</span><span class="p">,</span> <span class="n">bad</span><span class="p">]</span>
<span class="n">Categories</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="nb">object</span><span class="p">):</span> <span class="p">[</span><span class="n">bad</span> <span class="o">&lt;</span> <span class="n">medium</span> <span class="o">&lt;</span> <span class="n">good</span><span class="p">]</span>

<span class="c1"># binning into custom intervals
</span><span class="n">bins</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">100</span><span class="p">]</span>
<span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">]</span>
<span class="n">df</span><span class="p">[</span><span class="s">'binned'</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s">'percentage'</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">labels</span><span class="p">)</span>
<span class="k">print</span> <span class="p">(</span><span class="n">df</span><span class="p">)</span>
   <span class="n">percentage</span> <span class="n">binned</span>
<span class="mi">0</span>       <span class="mf">46.50</span>      <span class="mi">5</span>
<span class="mi">1</span>       <span class="mf">44.20</span>      <span class="mi">5</span>
<span class="mi">2</span>      <span class="mf">100.00</span>      <span class="mi">6</span>
<span class="mi">3</span>       <span class="mf">42.12</span>      <span class="mi">5</span>
</code></pre></div></div>

<p><a href="https://stackoverflow.com/questions/45273731/binning-column-with-python-pandas">source</a></p>

<p>Clipping (<a href="#top">top</a>)</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="c1"># removing outlier
</span><span class="n">df</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">lower</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">({</span><span class="s">'A'</span><span class="p">:</span> <span class="mf">2.5</span><span class="p">,</span> <span class="s">'B'</span><span class="p">:</span> <span class="mf">4.5</span><span class="p">}),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">Outlier</span> <span class="n">removal</span>
<span class="sb">``</span><span class="err">`</span><span class="n">python</span>
<span class="n">q</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s">"col"</span><span class="p">]</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="mf">0.99</span><span class="p">)</span>
<span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s">"col"</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">q</span><span class="p">]</span>

<span class="c1">#or 
</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">stats</span>
<span class="n">df</span><span class="p">[(</span><span class="n">np</span><span class="o">.</span><span class="nb">abs</span><span class="p">(</span><span class="n">stats</span><span class="o">.</span><span class="n">zscore</span><span class="p">(</span><span class="n">df</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="nb">all</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)]</span>
</code></pre></div></div>
<p><a href="https://stackoverflow.com/questions/23199796/detect-and-exclude-outliers-in-pandas-dataframe">source</a></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df</span><span class="p">[</span><span class="s">'Date of Publication'</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">extr</span><span class="p">)</span>

<span class="c1"># np.where
</span><span class="n">df</span><span class="p">[</span><span class="s">'Place of Publication'</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">london</span><span class="p">,</span> <span class="s">'London'</span><span class="p">,</span>
	 <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">oxford</span><span class="p">,</span> <span class="s">'Oxford'</span><span class="p">,</span> <span class="n">pub</span><span class="o">.</span><span class="nb">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">'-'</span><span class="p">,</span> <span class="s">' '</span><span class="p">)))</span>
 
<span class="c1"># 1929    1839, 38-54
# 2836        [1897?]
</span><span class="n">regex</span> <span class="o">=</span> <span class="s">r'^(\d{4})'</span>
<span class="n">extr</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s">'Date of Publication'</span><span class="p">]</span><span class="o">.</span><span class="nb">str</span><span class="o">.</span><span class="n">extract</span><span class="p">(</span><span class="s">r'^(\d{4})'</span><span class="p">,</span> <span class="n">expand</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

<span class="c1"># columns to ditionary
</span><span class="n">master_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="s">"term"</span><span class="p">)[[</span><span class="s">"term"</span><span class="p">,</span><span class="s">"uid"</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
</code></pre></div></div>

<p>pivoting table
<a href="https://stackoverflow.com/questions/47152691/how-to-pivot-a-dataframe">https://stackoverflow.com/questions/47152691/how-to-pivot-a-dataframe</a></p>

<p>replace with map</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">d</span> <span class="o">=</span> <span class="p">{</span><span class="s">'apple'</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s">'peach'</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span> <span class="s">'watermelon'</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="s">'grapes'</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="s">'orange'</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span><span class="s">'banana'</span><span class="p">:</span> <span class="mi">3</span><span class="p">}</span>

<span class="n">df</span><span class="p">[</span><span class="s">"fruit_tag"</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s">"fruit_tag"</span><span class="p">]</span><span class="o">.</span><span class="nb">map</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
</code></pre></div></div>

<p>regex matching groups
<a href="https://stackoverflow.com/questions/2554185/match-groups-in-python">https://stackoverflow.com/questions/2554185/match-groups-in-python</a></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">re</span>

<span class="n">mult</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="nb">compile</span><span class="p">(</span><span class="s">'(two|2) (?P&lt;race&gt;[a-z]+) (?P&lt;gender&gt;(?:fe)?male)s'</span><span class="p">)</span>
<span class="n">s</span> <span class="o">=</span> <span class="s">'two hispanic males, 2 hispanic females'</span>
<span class="n">mult</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">r'\g&lt;race&gt; \g&lt;gender&gt;, \g&lt;race&gt; \g&lt;gender&gt;'</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>
<span class="c1"># 'hispanic male, hispanic male, hispanic female, hispanic female'
</span>
</code></pre></div></div>
<p><a href="https://stackoverflow.com/questions/48348095/re-sub-in-pandas">source</a></p>

<p>(<a href="#top">top</a>)</p>

<p>test if type is string is equal</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>isinstance(s, str)
</code></pre></div></div>

<p>apply function to column</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>df['a'] = df['a'].apply(lambda x: x + 1)
</code></pre></div></div>

<p>exploding a column</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([{</span><span class="s">'var1'</span><span class="p">:</span> <span class="s">'a,b,c'</span><span class="p">,</span> <span class="s">'var2'</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span> <span class="p">{</span><span class="s">'var1'</span><span class="p">:</span> <span class="s">'d,e,f'</span><span class="p">,</span> <span class="s">'var2'</span><span class="p">:</span> <span class="mi">2</span><span class="p">}])</span> 
<span class="n">df</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">var1</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">var1</span><span class="o">.</span><span class="nb">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">','</span><span class="p">))</span><span class="o">.</span><span class="n">explode</span><span class="p">(</span><span class="s">'var1'</span><span class="p">)</span>
</code></pre></div></div>
<p><img src="https://pbs.twimg.com/media/ECGCmP4XkAENAtT.jpg" /></p>

<p>(<a href="#top">top</a>)</p>

<h1 id="performance">Performance</h1>

<h2 id="reshaping-dataframe">Reshaping dataframe</h2>
<p>The similarity between melt and stack: <a href="https://medium.com/dunder-data/minimally-sufficient-pandas-a8e67f2a2428">blog post</a></p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code></code></pre></div></div>

<p>sorting dataframe</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">"data/347136217_T_ONTIME.csv"</span><span class="p">)</span>
<span class="n">delays</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s">'DEP_DELAY'</span><span class="p">]</span>

<span class="c1"># Select the 5 largest delays
</span><span class="n">delays</span><span class="o">.</span><span class="n">nlargest</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">sort_values</span><span class="p">()</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">%</span><span class="n">timeit</span> <span class="n">delays</span><span class="o">.</span><span class="n">sort_values</span><span class="p">()</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="mi">31</span> <span class="n">ms</span> <span class="err">±</span> <span class="mf">1.05</span> <span class="n">ms</span> <span class="n">per</span> <span class="n">loop</span> <span class="p">(</span><span class="n">mean</span> <span class="err">±</span> <span class="n">std</span><span class="o">.</span> <span class="n">dev</span><span class="o">.</span> <span class="n">of</span> <span class="mi">7</span> <span class="n">runs</span><span class="p">,</span> <span class="mi">10</span> <span class="n">loops</span> <span class="n">each</span><span class="p">)</span>

<span class="o">%</span><span class="n">timeit</span> <span class="n">delays</span><span class="o">.</span><span class="n">nlargest</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">sort_values</span><span class="p">()</span>
<span class="mf">7.87</span> <span class="n">ms</span> <span class="err">±</span> <span class="mi">113</span> <span class="err">µ</span><span class="n">s</span> <span class="n">per</span> <span class="n">loop</span> <span class="p">(</span><span class="n">mean</span> <span class="err">±</span> <span class="n">std</span><span class="o">.</span> <span class="n">dev</span><span class="o">.</span> <span class="n">of</span> <span class="mi">7</span> <span class="n">runs</span><span class="p">,</span> <span class="mi">100</span> <span class="n">loops</span> <span class="n">each</span><span class="p">)</span>
</code></pre></div></div>

<p>check memory usage:</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">c</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s">'category'</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">'{:0.2f} KB'</span><span class="o">.</span><span class="nb">format</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">memory_usage</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">))</span>
</code></pre></div></div>

<p>(<a href="#top">top</a>)</p>

<h2 id="concat-vs-append">Concat vs. append</h2>
<p><a href="https://tomaugspurger.github.io/modern-4-performance.html">source</a></p>

<p>fast append via list of dictionaries:</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">rows_list</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">input_rows</span><span class="p">:</span>

        <span class="n">dict1</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c1"># get input row in dictionary format
</span>        <span class="c1"># key = col_name
</span>        <span class="n">dict1</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">blah</span><span class="o">..</span><span class="p">)</span> 

        <span class="n">rows_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dict1</span><span class="p">)</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">rows_list</span><span class="p">)</span>        
</code></pre></div></div>
<p>source: <a href="https://stackoverflow.com/questions/10715965/add-one-row-to-pandas-dataframe">link</a></p>

<p>alternatives</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#Append
</span><span class="k">def</span> <span class="nf">f1</span><span class="p">():</span>
	<span class="n">result</span> <span class="o">=</span> <span class="n">df</span>
	<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">9</span><span class="p">):</span>
		<span class="n">result</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
	<span class="k">return</span> <span class="n">result</span>
	
<span class="c1"># Concat
</span><span class="k">def</span> <span class="nf">f2</span><span class="p">():</span>
	<span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
	<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
		<span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
	<span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">101</span><span class="p">]:</span> <span class="o">%</span><span class="n">timeit</span> <span class="n">f1</span><span class="p">()</span>
<span class="mi">1</span> <span class="n">loops</span><span class="p">,</span> <span class="n">best</span> <span class="n">of</span> <span class="mi">3</span><span class="p">:</span> <span class="mf">1.66</span> <span class="n">s</span> <span class="n">per</span> <span class="n">loop</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">102</span><span class="p">]:</span> <span class="o">%</span><span class="n">timeit</span> <span class="n">f2</span><span class="p">()</span>
<span class="mi">1</span> <span class="n">loops</span><span class="p">,</span> <span class="n">best</span> <span class="n">of</span> <span class="mi">3</span><span class="p">:</span> <span class="mi">220</span> <span class="n">ms</span> <span class="n">per</span> <span class="n">loop</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">timings</span> <span class="o">=</span> <span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s">"Append"</span><span class="p">:</span> <span class="n">t_append</span><span class="p">,</span> <span class="s">"Concat"</span><span class="p">:</span> <span class="n">t_concat</span><span class="p">})</span>
             <span class="o">.</span><span class="n">stack</span><span class="p">()</span>
             <span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
             <span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s">'Time (s)'</span><span class="p">,</span>
                              <span class="s">'level_1'</span><span class="p">:</span> <span class="s">'Method'</span><span class="p">}))</span>
<span class="n">timings</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div></div>

<p>(<a href="#top">top</a>)</p>

<h2 id="dataframe-iterate-rows">Dataframe: iterate rows</h2>
<h3 id="useful-links">Useful links</h3>
<ul>
  <li>how-to-iterate-over-rows-in-a-dataframe-in-pandas: <a href="https://stackoverflow.com/questions/16476924/how-to-iterate-over-rows-in-a-dataframe-in-pandas">link</a></li>
  <li>how-to-make-your-pandas-loop-71-803-times-faster: <a href="https://towardsdatascience.com/how-to-make-your-pandas-loop-71-803-times-faster-805030df4f06">link</a></li>
  <li>example of bringing down runtime: iterrows, iloc, get_value, apply: <a href="https://medium.com/@rtjeannier/pandas-101-cont-9d061cb73bfc">link</a></li>
  <li>complex example using haversine_looping:  <a href="https://engineering.upside.com/a-beginners-guide-to-optimizing-pandas-code-for-speed-c09ef2c6a4d6">link</a>, <a href="https://nbviewer.jupyter.org/github/s-heisler/pycon2017-optimizing-pandas/blob/master/pyCon%20materials/PyCon%20un-sad%20Pandas.ipynb">jupyter notebook</a></li>
  <li>different-ways-to-iterate-over-rows-in-a-pandas-dataframe-performance-comparison: <a href="https://towardsdatascience.com/different-ways-to-iterate-over-rows-in-a-pandas-dataframe-performance-comparison-dc0d5dcef8fe">link</a></li>
  <li>pandas performance tweaks: <a href="https://pandas.pydata.org/pandas-docs/stable/user_guide/enhancingperf.html#cython-writing-c-extensions-for-pandas">cython</a>, <a href="https://pandas.pydata.org/pandas-docs/stable/user_guide/enhancingperf.html#using-numba">using numba</a></li>
</ul>

<p><img src="https://miro.medium.com/max/3000/1*e7fxK_4DK2QqpGNzoTADAA.png" alt="" /></p>

<ol>
  <li>Vectorization</li>
  <li>Cython routines</li>
  <li>List Comprehensions (vanilla  <code class="highlighter-rouge">for</code>  loop)</li>
  <li><a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.apply.html"><strong><code class="highlighter-rouge">DataFrame.apply()</code></strong></a>: i) Reductions that can be performed in cython, ii) Iteration in python space</li>
  <li><a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.itertuples.html"><strong><code class="highlighter-rouge">DataFrame.itertuples()</code></strong></a>  and  <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.iteritems.html#pandas.DataFrame.iteritems"><strong><code class="highlighter-rouge">iteritems()</code></strong></a></li>
  <li><a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.iterrows.html#pandas.DataFrame.iterrows"><strong><code class="highlighter-rouge">DataFrame.iterrows()</code></strong></a>
<img src="https://i.stack.imgur.com/kRSNB.png" alt="" /></li>
</ol>

<p>(<a href="#top">top</a>)</p>

<p>Profiling
book chapter from jakevdp: <a href="https://jakevdp.github.io/PythonDataScienceHandbook/01.07-timing-and-profiling.html">link</a></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">%</span><span class="n">timeit</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">))</span> <span class="c1"># single line
</span>
<span class="o">%</span><span class="n">timeit</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">4</span><span class="p">)[</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])]</span>
<span class="o">%</span><span class="n">timeit</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">4</span><span class="p">)[</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span><span class="o">.</span><span class="n">values</span><span class="p">]</span>
<span class="mi">111</span> <span class="err">µ</span><span class="n">s</span> <span class="err">±</span> <span class="mf">2.25</span> <span class="err">µ</span><span class="n">s</span> <span class="n">per</span> <span class="n">loop</span> <span class="p">(</span><span class="n">mean</span> <span class="err">±</span> <span class="n">std</span><span class="o">.</span> <span class="n">dev</span><span class="o">.</span> <span class="n">of</span> <span class="mi">7</span> <span class="n">runs</span><span class="p">,</span> <span class="mi">10000</span> <span class="n">loops</span> <span class="n">each</span><span class="p">)</span>
<span class="mf">61.1</span> <span class="err">µ</span><span class="n">s</span> <span class="err">±</span> <span class="mf">2.7</span> <span class="err">µ</span><span class="n">s</span> <span class="n">per</span> <span class="n">loop</span> <span class="p">(</span><span class="n">mean</span> <span class="err">±</span> <span class="n">std</span><span class="o">.</span> <span class="n">dev</span><span class="o">.</span> <span class="n">of</span> <span class="mi">7</span> <span class="n">runs</span><span class="p">,</span> <span class="mi">10000</span> <span class="n">loops</span> <span class="n">each</span><span class="p">)</span>


<span class="o">%%</span><span class="n">timeit</span> <span class="c1"># full cell
</span><span class="n">total</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1000</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1000</span><span class="p">):</span>
        <span class="n">total</span> <span class="o">+=</span> <span class="n">i</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">**</span> <span class="n">j</span>

<span class="c1"># profiling
</span><span class="k">def</span> <span class="nf">sum_of_lists</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
    <span class="n">total</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
        <span class="n">L</span> <span class="o">=</span> <span class="p">[</span><span class="n">j</span> <span class="o">^</span> <span class="p">(</span><span class="n">j</span> <span class="o">&gt;&gt;</span> <span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">)]</span>
        <span class="n">total</span> <span class="o">+=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">L</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">total</span>
<span class="o">%</span><span class="n">prun</span> <span class="n">sum_of_lists</span><span class="p">(</span><span class="mi">1000000</span><span class="p">)</span>

<span class="o">%</span><span class="n">load_ext</span> <span class="n">line_profiler</span>
<span class="o">%</span><span class="n">lprun</span> <span class="o">-</span><span class="n">f</span> <span class="n">sum_of_lists</span> <span class="n">sum_of_lists</span><span class="p">(</span><span class="mi">5000</span><span class="p">)</span>

<span class="c1"># memory usage
</span><span class="o">%</span><span class="n">load_ext</span> <span class="n">memory_profiler</span>
<span class="o">%</span><span class="n">memit</span> <span class="n">sum_of_lists</span><span class="p">(</span><span class="mi">1000000</span><span class="p">)</span>
</code></pre></div></div>

<p>performance plots (notebook <a href="https://render.githubusercontent.com/view/ipynb?commit=650571be86ebe8af6c1a86fed35ad9f7bbc0fe1e&amp;enc_url=68747470733a2f2f7261772e67697468756275736572636f6e74656e742e636f6d2f736f667468696e74732f707974686f6e2f363530353731626538366562653861663663316138366665643335616439663762626330666531652f6e6f7465626f6f6b732f70616e6461732f486f775f746f5f4f7074696d697a655f616e645f53706565645f55705f50616e6461732e6970796e62&amp;nwo=softhints%2Fpython&amp;path=notebooks%2Fpandas%2FHow_to_Optimize_and_Speed_Up_Pandas.ipynb&amp;repository_id=160945215&amp;repository_type=Repository#Do-tests">link</a>):</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">perfplot</span>  
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="n">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>

<span class="n">perfplot</span><span class="o">.</span><span class="n">show</span><span class="p">(</span>
    <span class="n">setup</span><span class="o">=</span><span class="k">lambda</span> <span class="n">n</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">2</span><span class="p">)),</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s">'A'</span><span class="p">,</span><span class="s">'B'</span><span class="p">]),</span>
    <span class="n">kernels</span><span class="o">=</span><span class="p">[</span>
        <span class="k">lambda</span> <span class="n">df</span><span class="p">:</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">A</span> <span class="o">!=</span> <span class="n">df</span><span class="o">.</span><span class="n">B</span><span class="p">],</span>
        <span class="k">lambda</span> <span class="n">df</span><span class="p">:</span> <span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s">'A != B'</span><span class="p">),</span>
        <span class="k">lambda</span> <span class="n">df</span><span class="p">:</span> <span class="n">df</span><span class="p">[[</span><span class="n">x</span> <span class="o">!=</span> <span class="n">y</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">A</span><span class="p">,</span> <span class="n">df</span><span class="o">.</span><span class="n">B</span><span class="p">)]]</span>
    <span class="p">],</span>
    <span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="s">'vectorized !='</span><span class="p">,</span> <span class="s">'query (numexpr)'</span><span class="p">,</span> <span class="s">'list comp'</span><span class="p">],</span>
    <span class="n">n_range</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="o">**</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">15</span><span class="p">)],</span>
    <span class="n">xlabel</span><span class="o">=</span><span class="s">'N'</span>
<span class="p">)</span>
</code></pre></div></div>

<p>(<a href="#top">top</a>)</p>

<p>list comprehension</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># iterating over one column - `f` is some function that processes your data
</span><span class="n">result</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">df</span><span class="p">[</span><span class="s">'col'</span><span class="p">]]</span>
<span class="c1"># iterating over two columns, use `zip`
</span><span class="n">result</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s">'col1'</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="s">'col2'</span><span class="p">])]</span>
<span class="c1"># iterating over multiple columns
</span><span class="n">result</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="o">...</span><span class="p">,</span> <span class="n">row</span><span class="p">[</span><span class="n">n</span><span class="p">])</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">df</span><span class="p">[[</span><span class="s">'col1'</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span><span class="s">'coln'</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span><span class="p">]</span>
</code></pre></div></div>

<p>Further tipps</p>
<ul>
  <li>Do numerical calculations with NumPy functions. They are two orders of magnitude faster than Python’s built-in tools.</li>
  <li>Of Python’s built-in tools, list comprehension is faster than  <code class="highlighter-rouge">map()</code>  , which is significantly faster than  <code class="highlighter-rouge">for</code>.</li>
  <li>For deeply recursive algorithms, loops are more efficient than recursive function calls.</li>
  <li>You cannot replace recursive loops with  <code class="highlighter-rouge">map()</code>, list comprehension, or a NumPy function.</li>
  <li>“Dumb” code (broken down into elementary operations) is the slowest. Use built-in functions and tools.</li>
</ul>

<p>source: <a href="https://github.com/mmamaev/looping_python/blob/master/ks_dp_solvers.py">example code</a>, <a href="https://www.freecodecamp.org/news/if-you-have-slow-loops-in-python-you-can-fix-it-until-you-cant-3a39e03b6f35/">link</a></p>

<p>(<a href="#top">top</a>)</p>

<h2 id="parallel-data-structures">Parallel data structures</h2>
<ul>
  <li><a href="https://towardsdatascience.com/make-your-own-super-pandas-using-multiproc-1c04f41944a1">https://towardsdatascience.com/make-your-own-super-pandas-using-multiproc-1c04f41944a1</a></li>
  <li><a href="https://github.com/modin-project/modin">https://github.com/modin-project/modin</a></li>
  <li><a href="https://github.com/jmcarpenter2/swifter">https://github.com/jmcarpenter2/swifter</a></li>
  <li><a href="https://towardsdatascience.com/an-overview-of-pythons-datatable-package-5d3a97394ee9">datatable blog post</a></li>
  <li>vaex: <a href="https://www.youtube.com/watch?v=2Tt0i823-ec">talk</a>, <a href="https://towardsdatascience.com/vaex-a-dataframe-with-super-strings-789b92e8d861">blog</a>,<a href="https://github.com/vaexio/vaex">github</a></li>
</ul>

<p><a href="https://learning.oreilly.com/library/view/python-high-performance/9781787282896/">https://learning.oreilly.com/library/view/python-high-performance/9781787282896/</a></p>

<p>get all combinations from two columns</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">tuples</span> <span class="o">=</span> <span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">dm_bmindex_df_without_index_df</span><span class="p">[[</span><span class="s">'trial'</span><span class="p">,</span> <span class="s">'biomarker_name'</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span><span class="p">]</span>
</code></pre></div></div>

<p>(<a href="#top">top</a>)</p>

<h1 id="jupyter-notebooks">Jupyter notebooks</h1>
<p>jupyter notebook best practices (<a href="https://towardsdatascience.com/jupyter-notebook-best-practices-f430a6ba8c69">link</a>): <a href="https://medium.com/p/f430a6ba8c69#87fc">structure your notebook</a>, 
automate jupyter execution: <a href="https://medium.com/@thabo_65610/three-ways-to-automate-python-via-jupyter-notebook-d14aaa78de9">link</a></p>

<ul>
  <li>Extensions: <a href="https://towardsdatascience.com/set-your-jupyter-notebook-up-right-with-this-extension-24921838a332">general</a>,</li>
  <li>snippets extension: <a href="https://jupyter-contrib-nbextensions.readthedocs.io/en/latest/nbextensions/snippets/README.html">link</a></li>
  <li>convert notebook. post-save hook: <a href="https://gist.github.com/ceshine/2a68a96e7a9f72551d00c5578249340f">gist</a></li>
  <li>jupyter theme <a href="https://github.com/dunovank/jupyter-themes">github link</a>:
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">jt</span> <span class="o">-</span><span class="n">t</span> <span class="n">grade3</span> <span class="o">-</span><span class="n">fs</span> <span class="mi">95</span> <span class="o">-</span><span class="n">altp</span> <span class="o">-</span><span class="n">tfs</span> <span class="mi">11</span> <span class="o">-</span><span class="n">nfs</span> <span class="mi">115</span> <span class="o">-</span><span class="n">cellw</span> <span class="mi">88</span><span class="o">%</span> <span class="o">-</span><span class="n">T</span>
</code></pre></div>    </div>
    <p>From jupyter notebooks to standalone apps (Voila): 
<a href="https://github.com/QuantStack/voila">github</a>, <a href="https://blog.jupyter.org/and-voil%C3%A0-f6a2c08a4a93">blog</a> (example <a href="https://github.com/QuantStack/voila/pull/217">github PR</a>)</p>
  </li>
</ul>

<p>jupyter lab:  Shortcut to run single command: <a href="https://stackoverflow.com/questions/38648286/in-jupyter-lab-execute-editor-code-in-python-console/56340407#56340407">stackoverflow</a></p>

<h2 id="notebooks-in-production">Notebooks in production</h2>
<p>directory structure, layout, workflow: <a href="https://pbpython.com/notebook-process.html">blog post</a>
also: <a href="http://drivendata.github.io/cookiecutter-data-science/">cookiecutter</a></p>

<h3 id="workflow">workflow</h3>

<p><img src="https://pbpython.com/images/Notebook_Best_Practices_flow.png" alt="" /></p>

<p>(<a href="#top">top</a>)</p>

<h3 id="directory-structure">Directory structure</h3>
<ul>
  <li><code class="highlighter-rouge">raw</code>  - Contains the unedited csv and Excel files used as the source for analysis.</li>
  <li><code class="highlighter-rouge">interim</code>  - Used if there is a multi-step manipulation. This is a scratch location and not always needed but helpful to have in place so directories do not get cluttered or as a temp location form troubleshooting issues.</li>
  <li><code class="highlighter-rouge">processed</code>  - In many cases, I read in multiple files, clean them up and save them to a new location in a binary format. This streamlined format makes it easier to read in larger files later in the processing pipeline.</li>
</ul>

<p>(<a href="#top">top</a>)</p>

<h3 id="further-link">Further link</h3>
<p>how netflix runs notebooks: scheduling, integration testing: <a href="https://blog.goodaudience.com/inside-netflixs-notebook-driven-architecture-aedded32145e">link</a></p>

<h3 id="jupyter-notebook-template">jupyter notebook template</h3>

<h4 id="header-section">header section</h4>
<ul>
  <li>A good name for the notebook (as described above)</li>
  <li>A summary header that describes the project</li>
  <li>Free form description of the business reason for this notebook. I like to include names, dates and snippets of emails to make sure I remember the context.</li>
  <li>A list of people/systems where the data originated.</li>
  <li>I include a simple change log. I find it helpful to record when I started and any major changes along the way. I do not update it with every single change but having some date history is very beneficial.</li>
</ul>

<p>(<a href="#top">top</a>)</p>

<h3 id="orchestration">Orchestration</h3>
<p><a href="https://taskfile.dev/#/">https://taskfile.dev/#/</a></p>

<h3 id="jupyter-code-snippets">jupyter code snippets</h3>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># jupyter notebook --generate-config
</span><span class="n">jupyter</span> <span class="n">notebook</span> <span class="o">--</span><span class="n">generate</span><span class="o">-</span><span class="n">config</span>

<span class="c1"># start in screen session
</span><span class="n">screen</span> <span class="o">-</span><span class="n">d</span> <span class="o">-</span><span class="n">m</span> <span class="o">-</span><span class="n">S</span> <span class="n">JUPYTER</span> <span class="n">jupyter</span> <span class="n">notebook</span> <span class="o">--</span><span class="n">ip</span> <span class="mf">0.0.0.0</span> <span class="o">--</span><span class="n">port</span> <span class="mi">8889</span> <span class="o">--</span><span class="n">no</span><span class="o">-</span><span class="n">browser</span> <span class="o">--</span><span class="n">NotebookApp</span><span class="o">.</span><span class="n">token</span><span class="o">=</span><span class="s">''</span>

<span class="c1"># install packages in jupyter
</span><span class="err">!</span><span class="n">pip</span> <span class="n">install</span> <span class="n">package</span><span class="o">-</span><span class="n">name</span>

<span class="c1"># environment variables
</span><span class="o">%%</span><span class="n">bash</span>
<span class="n">which</span> <span class="n">python</span>

<span class="c1"># reset/set password
</span><span class="n">jupyter</span> <span class="n">notebook</span> <span class="n">password</span>

<span class="c1"># show all running notebooks
</span><span class="n">jupyter</span> <span class="n">notebook</span> <span class="nb">list</span>
<span class="c1"># (Can be useful to get a hash for a notebook)
</span></code></pre></div></div>
<p>append to path</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">os.path</span> <span class="kn">import</span> <span class="n">dirname</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dirname</span><span class="p">(</span><span class="n">__file__</span><span class="p">))</span>
</code></pre></div></div>

<p>hide warnings</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s">'ignore'</span><span class="p">)</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="n">action</span><span class="o">=</span><span class="s">'once'</span><span class="p">)</span>
</code></pre></div></div>

<p>tqdm (<a href="#top">top</a>)</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">tqdm</span> <span class="kn">import</span> <span class="n">tqdm</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">10000</span><span class="p">)):</span>
</code></pre></div></div>
<p>qqrid (<a href="#top">top</a>)</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">qqrid</span>
<span class="n">qqrid_widget</span> <span class="o">=</span> <span class="n">qqrid</span><span class="o">.</span><span class="n">show_grid</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">show_toolbar</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">qqrid_widget</span>
</code></pre></div></div>
<p>print all numpy</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>import numpy
numpy.set_printoptions(threshold=numpy.nan)
</code></pre></div></div>

<p>Debugging:</p>

<p>ipdb</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># debug ipdb
from IPython.core.debugger import set_trace

def select_condition(tmp):
    set_trace()
</code></pre></div></div>

<p><a href="https://medium.com/ibm-watson-data-lab/the-visual-python-debugger-for-jupyter-notebooks-youve-always-wanted-761713babc62">Pixie debugger</a></p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="c1"># built-in profiler
</span><span class="o">%</span><span class="n">prun</span> <span class="o">-</span><span class="n">l</span> <span class="mi">4</span> <span class="n">estimate_and_update</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>

<span class="c1"># line by line profiling
</span><span class="n">pip</span> <span class="n">install</span> <span class="n">line_profiler</span>
<span class="o">%</span><span class="n">load_ext</span> <span class="n">line_profiler</span>
<span class="o">%</span><span class="n">lprun</span> <span class="o">-</span><span class="n">f</span> <span class="n">sum_of_lists</span> <span class="n">sum_of_lists</span><span class="p">(</span><span class="mi">5000</span><span class="p">)</span>

<span class="c1"># memory usage
</span><span class="n">pip</span> <span class="n">install</span> <span class="n">memory_profiler</span>
<span class="o">%</span><span class="n">load_ext</span> <span class="n">memory_profiler</span>
<span class="o">%</span><span class="n">memit</span> <span class="n">sum_of_lists</span><span class="p">(</span><span class="mi">1000000</span><span class="p">)</span>
</code></pre></div></div>
<p>source: <a href="https://jakevdp.github.io/PythonDataScienceHandbook/01.07-timing-and-profiling.html">Timing and profiling</a></p>

<p>add tags to jupyterlab: <a href="https://github.com/jupyterlab/jupyterlab/issues/4100">https://github.com/jupyterlab/jupyterlab/issues/4100</a></p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{
    "tags": [
        "to_remove"
    ],
    "slideshow": {
        "slide_type": "fragment"
    }
}
</code></pre></div></div>

<p>removing tags: <a href="https://groups.google.com/forum/#!topic/jupyter/W2M_nLbboj4">https://groups.google.com/forum/#!topic/jupyter/W2M_nLbboj4</a></p>

<p>(<a href="#top">top</a>)</p>

<h2 id="timing-and-profiling">Timing and Profiling</h2>
<p><a href="https://jakevdp.github.io/PythonDataScienceHandbook/01.07-timing-and-profiling.html">https://jakevdp.github.io/PythonDataScienceHandbook/01.07-timing-and-profiling.html</a></p>

<h3 id="test-code">test code</h3>
<p><a href="https://mikulskibartosz.name/test-driven-development-in-jupyter-notebook-2eb3595be3cd">test driven development in jupyter notebook</a></p>

<p>asserts</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">multiplyByTwo</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>  
    <span class="k">return</span> <span class="n">x</span> <span class="o">*</span> <span class="mi">3</span>

<span class="k">assert</span> <span class="n">multiplyByTwo</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span><span class="p">,</span> <span class="s">"2 multiplied by 2 should be equal 4"</span>

<span class="c1"># test file size
</span><span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getsize</span><span class="p">(</span><span class="n">bm_index_master_file</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">150000000</span><span class="p">,</span> <span class="s">'Output file size should be &gt; 150Mb'</span>

<span class="c1"># assert is nan
</span><span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">ret_none</span><span class="p">),</span> <span class="n">f</span><span class="s">"Can't deal with 'None values': {ret_none} == {np.nan}"</span>
</code></pre></div></div>

<p>Production-ready notebooks: <a href="http://blog.juliusschulz.de/blog/ultimate-ipython-notebook">link</a>
If tqdm doesnt work:
install <a href="https://github.com/jupyter-widgets/ipywidgets">ipywidgets</a>
Hbox full: <a href="https://github.com/tqdm/tqdm/issues/451">link</a></p>

<h3 id="qgrid">Qgrid</h3>
<p><a href="https://github.com/quantopian/qgrid/blob/master/README.rst">Qgrid readme</a></p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">qgrid</span><span class="o">.</span><span class="n">show_grid</span><span class="p">(</span><span class="n">e_tpatt_df</span><span class="p">,</span> <span class="n">grid_options</span><span class="o">=</span><span class="p">{</span><span class="s">'forceFitColumns'</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span> <span class="s">'defaultColumnWidth'</span><span class="p">:</span> <span class="mi">100</span><span class="p">})</span>
</code></pre></div></div>

<h3 id="debugging-conda">Debugging conda</h3>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># conda show install versions
</span><span class="kn">import</span> <span class="nn">sys</span> <span class="k">print</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
<span class="ow">or</span>
<span class="kn">import</span> <span class="nn">sys</span><span class="p">,</span> <span class="n">fastai</span> 
<span class="k">print</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s">'fastai'</span><span class="p">])</span>
</code></pre></div></div>

<h3 id="running-jupyter">Running Jupyter</h3>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="n">jupyter</span> <span class="n">notebook</span> <span class="o">--</span><span class="n">browser</span><span class="o">=</span><span class="n">false</span> <span class="o">&amp;&gt;</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">null</span> <span class="o">&amp;</span>
<span class="o">--</span><span class="n">matplotlib</span> <span class="n">inline</span> <span class="o">--</span><span class="n">port</span><span class="o">=</span><span class="mi">9777</span> <span class="o">--</span><span class="n">browser</span><span class="o">=</span><span class="n">false</span>

<span class="c1"># Check GPU is working GPU working
</span>
<span class="kn">from</span> <span class="nn">tensorflow.python.client</span> <span class="kn">import</span> <span class="n">device_lib</span>

<span class="k">def</span> <span class="nf">get_available_devices</span><span class="p">():</span>  
    <span class="n">local_device_protos</span> <span class="o">=</span> <span class="n">device_lib</span><span class="o">.</span><span class="n">list_local_devices</span><span class="p">()</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">local_device_protos</span><span class="p">]</span>

<span class="k">print</span><span class="p">(</span><span class="n">get_available_devices</span><span class="p">())</span> 
</code></pre></div></div>

<p>(<a href="#top">top</a>)</p>

<h3 id="installing-kernels">installing kernels</h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># conda install kernel
source activate &lt;ANACONDA_ENVIRONMENT_NAME&gt;  
pip install ipykernel  
python -m ipykernel install --user

or 

source activate myenv
python -m ipykernel install --user --name myenv --display-name "Python (myenv)"
</code></pre></div></div>
<p><a href="https://stackoverflow.com/questions/39604271/conda-environments-not-showing-up-in-jupyter-notebook">source stackoverflow</a></p>

<p>(<a href="#top">top</a>)</p>

<p>##</p>

<h2 id="unsorted">unsorted</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># use dictionary to count list
</span><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">Counter</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">Counter</span><span class="p">([</span><span class="s">'apple'</span><span class="p">,</span><span class="s">'red'</span><span class="p">,</span><span class="s">'apple'</span><span class="p">,</span><span class="s">'red'</span><span class="p">,</span><span class="s">'red'</span><span class="p">,</span><span class="s">'pear'</span><span class="p">])</span>
<span class="n">Counter</span><span class="p">({</span><span class="s">'red'</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s">'apple'</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s">'pear'</span><span class="p">:</span> <span class="mi">1</span><span class="p">})</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># dictionary keys to list
</span><span class="nb">list</span><span class="p">(</span><span class="nb">dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># dictionary remove nan
# if nan in keys
</span><span class="n">clean_dict</span> <span class="o">=</span> <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">k</span><span class="p">:</span> <span class="ow">not</span> <span class="n">isnan</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="n">my_dict</span><span class="p">)</span>
<span class="c1"># if nan in values
</span><span class="n">clean_dict</span> <span class="o">=</span> <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">k</span><span class="p">:</span> <span class="ow">not</span> <span class="n">isnan</span><span class="p">(</span><span class="n">my_dict</span><span class="p">[</span><span class="n">k</span><span class="p">]),</span> <span class="n">my_dict</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># list remove nan
</span><span class="n">cleanedList</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">countries</span> <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">!=</span> <span class="s">'nan'</span><span class="p">]</span>
</code></pre></div></div>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># pandas convert all columns to lowercase
</span><span class="n">df</span><span class="o">.</span><span class="nb">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span><span class="o">.</span><span class="nb">str</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># pandas set difference tow columns 
# source: https://stackoverflow.com/questions/18180763/set-difference-for-pandas
</span><span class="kn">from</span> <span class="nn">pandas</span> <span class="kn">import</span>  <span class="n">DataFrame</span>

<span class="n">df1</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">({</span><span class="s">'col1'</span><span class="p">:[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span> <span class="s">'col2'</span><span class="p">:[</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">]})</span>
<span class="n">df2</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">({</span><span class="s">'col1'</span><span class="p">:[</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">5</span><span class="p">],</span> <span class="s">'col2'</span><span class="p">:[</span><span class="mi">6</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span><span class="p">]})</span>

<span class="k">print</span> <span class="n">df2</span><span class="p">[</span><span class="o">~</span><span class="n">df2</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">df1</span><span class="p">)</span><span class="o">.</span><span class="nb">all</span><span class="p">(</span><span class="mi">1</span><span class="p">)]</span>
<span class="k">print</span> <span class="n">df2</span><span class="p">[(</span><span class="n">df2</span><span class="o">!=</span><span class="n">df1</span><span class="p">)]</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">how</span><span class="o">=</span><span class="s">'all'</span><span class="p">)</span>
<span class="k">print</span> <span class="n">df2</span><span class="p">[</span><span class="o">~</span><span class="p">(</span><span class="n">df2</span><span class="o">==</span><span class="n">df1</span><span class="p">)]</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">how</span><span class="o">=</span><span class="s">'all'</span><span class="p">)</span>

<span class="c1"># union
</span><span class="k">print</span><span class="p">(</span><span class="s">"Union :"</span><span class="p">,</span> <span class="n">A</span> <span class="o">|</span> <span class="n">B</span><span class="p">)</span>
<span class="c1"># intersection
</span><span class="k">print</span><span class="p">(</span><span class="s">"Intersection :"</span><span class="p">,</span> <span class="n">A</span> <span class="o">&amp;</span> <span class="n">B</span><span class="p">)</span>
<span class="c1"># difference
</span><span class="k">print</span><span class="p">(</span><span class="s">"Difference :"</span><span class="p">,</span> <span class="n">A</span> <span class="o">-</span> <span class="n">B</span><span class="p">)</span>
<span class="c1"># symmetric difference
</span><span class="k">print</span><span class="p">(</span><span class="s">"Symmetric difference :"</span><span class="p">,</span> <span class="n">A</span> <span class="o">^</span> <span class="n">B</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># pandas value counts to dataframe
</span><span class="n">df</span> <span class="o">=</span> <span class="n">value_counts</span><span class="o">.</span><span class="n">rename_axis</span><span class="p">(</span><span class="s">'unique_values'</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">'counts'</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># python dictionary get first key
</span><span class="nb">list</span><span class="p">(</span><span class="n">tree_number_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># pandas dataframe get cell value by condition
</span><span class="n">function</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s">'condition'</span><span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">(),</span><span class="s">'condition'</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># dataframe drop duplicates keep first
</span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">cols</span><span class="o">=</span><span class="s">'index'</span><span class="p">,</span><span class="n">take_last</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span><span class="c1"># 2 use new col
</span></code></pre></div></div>

<p>(<a href="#top">top</a>)</p>
